---
layout: single
title: "HW3. Data Visualization"
permalink: /coursework/SI618/hw3/
comments: false
author_profile: true
read_time: true
toc: true
toc_label: "Table of Contents"
toc_sticky: true
categories: ["SI618"]
---

**Topics: Data visualization**

--- 

**Background**

This homework assignment focuses on the visual analysis of the COVID-19 data avaiable here: https://covid19datahub.io/articles/api/python.html. A description of the dataset can be found at https://covid19datahub.io/articles/doc/data.html

Your main task in this assignment is to explore the data *using the data manipulation, analysis, and visualization methods we covered in class* as well as those in the assigned readings.  You may need to consult pandas, matplotlib and seaborn documentation, as well as Stack Overflow, or other online resources.  

**Total Points and Rubric**

Each question is worth the same number of points.  Points will be allocated according to the following rubric:

- 90-100%: Question is correctly and completely answered.  Answer consists of well-written code that conforms to [PEP 8](https://www.python.org/dev/peps/pep-0008/) guidelines and is 
accompanied by a written interpretation in a Markdown block.  Written interpretation does not contain spelling, grammar or stylistic errors (see https://faculty.washington.edu/heagerty/Courses/b572/public/StrunkWhite.pdf for a detailed specifications).  Minor problems, such as formatting, incorrect submissions, missing names, etc. will result in less than 100%.
- 75-85% : Answer is mostly complete and correct; two or fewer noticeable omissions or errors.  Minor stylistic flaws, either in code or in 
written interpretation.
- 50-70%: Answer has significant omissions or errors; Noticeable departure from PEP-8 guildelines and/or moderate spelling, grammar, or style issues
in written interpretations.
- 25-45%: Question is perfunctorily attempted.  Substantial parts are missing or incorrect.
- 0 points: Question not attempted.


```python
MY_UNIQNAME = 'yjwoo' # please fill in your uniqname
```

**Getting the data**


The following cell should install the most up-to-date version of the 
COVID-19 datahub.  Alternatively, you can consult the datahub documentation to download the data files directly.


```python
pip install --upgrade covid19dh
```

    Requirement already satisfied: covid19dh in /opt/anaconda3/lib/python3.9/site-packages (2.3.0)
    Requirement already satisfied: requests in /opt/anaconda3/lib/python3.9/site-packages (from covid19dh) (2.26.0)
    Requirement already satisfied: pandas in /opt/anaconda3/lib/python3.9/site-packages (from covid19dh) (1.3.4)
    Requirement already satisfied: python-dateutil>=2.7.3 in /opt/anaconda3/lib/python3.9/site-packages (from pandas->covid19dh) (2.8.2)
    Requirement already satisfied: pytz>=2017.3 in /opt/anaconda3/lib/python3.9/site-packages (from pandas->covid19dh) (2021.3)
    Requirement already satisfied: numpy>=1.17.3 in /opt/anaconda3/lib/python3.9/site-packages (from pandas->covid19dh) (1.20.3)
    Requirement already satisfied: six>=1.5 in /opt/anaconda3/lib/python3.9/site-packages (from python-dateutil>=2.7.3->pandas->covid19dh) (1.16.0)
    Requirement already satisfied: certifi>=2017.4.17 in /opt/anaconda3/lib/python3.9/site-packages (from requests->covid19dh) (2021.10.8)
    Requirement already satisfied: charset-normalizer~=2.0.0 in /opt/anaconda3/lib/python3.9/site-packages (from requests->covid19dh) (2.0.4)
    Requirement already satisfied: idna<4,>=2.5 in /opt/anaconda3/lib/python3.9/site-packages (from requests->covid19dh) (3.2)
    Requirement already satisfied: urllib3<1.27,>=1.21.1 in /opt/anaconda3/lib/python3.9/site-packages (from requests->covid19dh) (1.26.7)
    Note: you may need to restart the kernel to use updated packages.


**Restart the kernel to import the module and access the data**


```python
from covid19dh import covid19
```

**Answer the questions below.**       
For each question, you should
1. Write code that can help you answer the following questions, and
2. Explain your answers in plain English. You should use complete sentences that would be understood by an educated professional who is not necessarily a data scientist (like a product manager).


```python
# Load all the modules
import pandas as pd
import numpy as np
import matplotlib.pyplot as plt
import seaborn as sns
from matplotlib.dates import datestr2num
```


```python
import warnings
warnings.filterwarnings('ignore')
```

## <font color='#8B0000'> Q1 How many different countries are represented in the country-level data set?</font>
- Refer to the documentation to call the covid19() function with appropriate parameters (https://covid19datahub.io/articles/api/python.html)


```python
df_covid_country_level, src = covid19(level = 1) 
df_covid_country_level.head()
```

    We have invested a lot of time and effort in creating COVID-19 Data Hub, please cite the following when using it:
    
    	[1mGuidotti, E., Ardia, D., (2020), "COVID-19 Data Hub", Journal of Open Source Software 5(51):2376, doi: 10.21105/joss.02376.[0m
    
    A BibTeX entry for LaTeX users is
    
    	@Article{,
    		title = {COVID-19 Data Hub},
    		year = {2020},
    		doi = {10.21105/joss.02376},
    		author = {Emanuele Guidotti and David Ardia},
    		journal = {Journal of Open Source Software},
    		volume = {5},
    		number = {51},
    		pages = {2376},
    	}
    
    [33mTo hide this message use 'verbose = False'.[0m





<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>confirmed</th>
      <th>deaths</th>
      <th>recovered</th>
      <th>tests</th>
      <th>vaccines</th>
      <th>people_vaccinated</th>
      <th>people_fully_vaccinated</th>
      <th>hosp</th>
      <th>...</th>
      <th>iso_alpha_3</th>
      <th>iso_alpha_2</th>
      <th>iso_numeric</th>
      <th>iso_currency</th>
      <th>key_local</th>
      <th>key_google_mobility</th>
      <th>key_apple_mobility</th>
      <th>key_jhu_csse</th>
      <th>key_nuts</th>
      <th>key_gadm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>87758</th>
      <td>0094b645</td>
      <td>2020-01-22</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>LCA</td>
      <td>LC</td>
      <td>662.0</td>
      <td>XCD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>LC</td>
      <td>NaN</td>
      <td>LCA</td>
    </tr>
    <tr>
      <th>87759</th>
      <td>0094b645</td>
      <td>2020-01-23</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>LCA</td>
      <td>LC</td>
      <td>662.0</td>
      <td>XCD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>LC</td>
      <td>NaN</td>
      <td>LCA</td>
    </tr>
    <tr>
      <th>87760</th>
      <td>0094b645</td>
      <td>2020-01-24</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>LCA</td>
      <td>LC</td>
      <td>662.0</td>
      <td>XCD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>LC</td>
      <td>NaN</td>
      <td>LCA</td>
    </tr>
    <tr>
      <th>87761</th>
      <td>0094b645</td>
      <td>2020-01-25</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>LCA</td>
      <td>LC</td>
      <td>662.0</td>
      <td>XCD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>LC</td>
      <td>NaN</td>
      <td>LCA</td>
    </tr>
    <tr>
      <th>87762</th>
      <td>0094b645</td>
      <td>2020-01-26</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>LCA</td>
      <td>LC</td>
      <td>662.0</td>
      <td>XCD</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>LC</td>
      <td>NaN</td>
      <td>LCA</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 47 columns</p>
</div>




```python
df_covid_country_level.shape
```




    (167987, 47)



There is a total of 168,987 rows and 47 columns in the country-level data set.


```python
len(df_covid_country_level["administrative_area_level_1"].unique())
```




    236



We can check that there is a total of 236 countries in the country-level data set. It can be seen that almost all countries are included in the data.


```python
df_covid_country_level.groupby(["administrative_area_level_1"]).nunique().date.sort_values()
```




    administrative_area_level_1
    Grand Princess      10
    Niue                43
    Costa Atlantica     81
    Pitcairn            85
    Tokelau            114
                      ... 
    United Kingdom     758
    Argentina          766
    Thailand           766
    China              767
    Mexico             768
    Name: date, Length: 236, dtype: int64




```python
df_covid_country_level.groupby(["administrative_area_level_1"]).nunique().date.sort_values().plot.hist(bins = 10)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_18_0.png)
    


Most countries have more than 600 days of data, but some like Grand Princess, Niue, Costa Atlantica have less than 100 days of data.

## <font color='#8B0000'> Q2 Create a line chart that shows the total number of cases over time.</font>


```python
df_confirmed_case = df_covid_country_level[["date", "confirmed", "administrative_area_level_1"]].sort_values(["administrative_area_level_1", "date"]).rename(columns = {"confirmed" : "cum_confirmed", "administrative_area_level_1" : "country"})
```


```python
df_confirmed_case["daily_confirmed"] = df_confirmed_case.groupby("country").cum_confirmed.diff().fillna(df_confirmed_case['cum_confirmed'])
df_confirmed_case = df_confirmed_case[["date", "country", "daily_confirmed", "cum_confirmed"]]
```


```python
df_confirmed_case['year_month'] = df_confirmed_case['date'].dt.strftime('%Y-%m')
```


```python
df_confirmed_case_monthly = df_confirmed_case[df_confirmed_case.daily_confirmed > 0].groupby("year_month").daily_confirmed.sum() \
                                .cumsum().reset_index().rename({"daily_confirmed" : "cum_confirmed"}, axis = 1) \
                                .merge(df_confirmed_case[df_confirmed_case.daily_confirmed > 0].groupby("year_month").daily_confirmed.sum(), on = "year_month", how = "left") \
                                .rename(columns = {"daily_confirmed" : "monthly_confirmed"})[["year_month", "monthly_confirmed", "cum_confirmed"]]
df_confirmed_case_monthly
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>year_month</th>
      <th>monthly_confirmed</th>
      <th>cum_confirmed</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2020-01</td>
      <td>9863.0</td>
      <td>9863.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2020-02</td>
      <td>76682.0</td>
      <td>86545.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2020-03</td>
      <td>794611.0</td>
      <td>881156.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2020-04</td>
      <td>2365557.0</td>
      <td>3246713.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2020-05</td>
      <td>2901122.0</td>
      <td>6147835.0</td>
    </tr>
    <tr>
      <th>5</th>
      <td>2020-06</td>
      <td>4325821.0</td>
      <td>10473656.0</td>
    </tr>
    <tr>
      <th>6</th>
      <td>2020-07</td>
      <td>7163395.0</td>
      <td>17637051.0</td>
    </tr>
    <tr>
      <th>7</th>
      <td>2020-08</td>
      <td>7945496.0</td>
      <td>25582547.0</td>
    </tr>
    <tr>
      <th>8</th>
      <td>2020-09</td>
      <td>8590723.0</td>
      <td>34173270.0</td>
    </tr>
    <tr>
      <th>9</th>
      <td>2020-10</td>
      <td>12270240.0</td>
      <td>46443510.0</td>
    </tr>
    <tr>
      <th>10</th>
      <td>2020-11</td>
      <td>17166584.0</td>
      <td>63610094.0</td>
    </tr>
    <tr>
      <th>11</th>
      <td>2020-12</td>
      <td>20545820.0</td>
      <td>84155914.0</td>
    </tr>
    <tr>
      <th>12</th>
      <td>2021-01</td>
      <td>19477426.0</td>
      <td>103633340.0</td>
    </tr>
    <tr>
      <th>13</th>
      <td>2021-02</td>
      <td>11261962.0</td>
      <td>114895302.0</td>
    </tr>
    <tr>
      <th>14</th>
      <td>2021-03</td>
      <td>14932777.0</td>
      <td>129828079.0</td>
    </tr>
    <tr>
      <th>15</th>
      <td>2021-04</td>
      <td>22558324.0</td>
      <td>152386403.0</td>
    </tr>
    <tr>
      <th>16</th>
      <td>2021-05</td>
      <td>19702300.0</td>
      <td>172088703.0</td>
    </tr>
    <tr>
      <th>17</th>
      <td>2021-06</td>
      <td>14202707.0</td>
      <td>186291410.0</td>
    </tr>
    <tr>
      <th>18</th>
      <td>2021-07</td>
      <td>15836422.0</td>
      <td>202127832.0</td>
    </tr>
    <tr>
      <th>19</th>
      <td>2021-08</td>
      <td>20077425.0</td>
      <td>222205257.0</td>
    </tr>
    <tr>
      <th>20</th>
      <td>2021-09</td>
      <td>15994751.0</td>
      <td>238200008.0</td>
    </tr>
    <tr>
      <th>21</th>
      <td>2021-10</td>
      <td>12989702.0</td>
      <td>251189710.0</td>
    </tr>
    <tr>
      <th>22</th>
      <td>2021-11</td>
      <td>15805885.0</td>
      <td>266995595.0</td>
    </tr>
    <tr>
      <th>23</th>
      <td>2021-12</td>
      <td>25519483.0</td>
      <td>292515078.0</td>
    </tr>
    <tr>
      <th>24</th>
      <td>2022-01</td>
      <td>80602125.0</td>
      <td>373117203.0</td>
    </tr>
    <tr>
      <th>25</th>
      <td>2022-02</td>
      <td>12923794.0</td>
      <td>386040997.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
fig, ax1 = plt.subplots(figsize = (30, 8))

# cumulative line chart
color = "tab:green"
ax1 = sns.lineplot(x = "year_month", y = "cum_confirmed", color = color, linewidth = 3, \
                   data = df_confirmed_case_monthly)
ax1.set_xlabel("Year-Month", fontsize = 16)
ax1.set_ylabel("Cumulative cases", color = color, fontsize = 16)

# monthly bar chart
ax2 = ax1.twinx()
color = "tab:blue"
ax2 = sns.barplot(x = "year_month", y = "monthly_confirmed", color = color, alpha = 0.5, \
                  data = df_confirmed_case_monthly)
ax2.set_ylabel("Monthly cases", color = color, fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_25_0.png)
    


The table and graph above show the total number of confirmed cases by monthly and cumulatively. In January 2020, there were a total of 9863 cases, and it steadily increased, and in February of 22, there were approximately 380 million cases. The number of monthly cases steadily increased and then remained at around 15 to 20 million, and then surged to 80 million per month in January 2022.

## <font color='#8B0000'>Q3 Use the country-level data set to create a histogram to:</font>
- Show the distribution of values for the number of hospitalizations per 1000 people.  
- Draw a red vertical line that shows the median value on the histogram.


```python
df_hospitalization = df_covid_country_level[["date", "hosp", "population", "administrative_area_level_1"]].dropna()
df_hospitalization = df_hospitalization[df_hospitalization.hosp > 0]
df_hospitalization["hosp/pop"] = df_hospitalization.hosp / df_hospitalization.population * 1000
```


```python
df_hospitalization["hosp/pop"].describe()
```




    count    28379.000000
    mean         0.306831
    std          5.254355
    min          0.000024
    25%          0.029287
    50%          0.088823
    75%          0.235695
    max        239.165329
    Name: hosp/pop, dtype: float64



75% of the data are below 0.23, while the maximum is 239. In other words, we think that there is an outlier on the large value side.


```python
df_hospitalization.sort_values("hosp/pop", ascending = False).head(10)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>hosp</th>
      <th>population</th>
      <th>administrative_area_level_1</th>
      <th>hosp/pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>205</th>
      <td>2020-05-07</td>
      <td>149.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>239.165329</td>
    </tr>
    <tr>
      <th>203</th>
      <td>2020-05-05</td>
      <td>149.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>239.165329</td>
    </tr>
    <tr>
      <th>206</th>
      <td>2020-05-08</td>
      <td>149.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>239.165329</td>
    </tr>
    <tr>
      <th>204</th>
      <td>2020-05-06</td>
      <td>149.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>239.165329</td>
    </tr>
    <tr>
      <th>194</th>
      <td>2020-04-26</td>
      <td>148.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>237.560193</td>
    </tr>
    <tr>
      <th>195</th>
      <td>2020-04-27</td>
      <td>148.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>237.560193</td>
    </tr>
    <tr>
      <th>196</th>
      <td>2020-04-28</td>
      <td>148.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>237.560193</td>
    </tr>
    <tr>
      <th>197</th>
      <td>2020-04-29</td>
      <td>148.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>237.560193</td>
    </tr>
    <tr>
      <th>198</th>
      <td>2020-04-30</td>
      <td>148.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>237.560193</td>
    </tr>
    <tr>
      <th>199</th>
      <td>2020-05-01</td>
      <td>148.0</td>
      <td>623.0</td>
      <td>Costa Atlantica</td>
      <td>237.560193</td>
    </tr>
  </tbody>
</table>
</div>



If you look at the cases where the number is abnormally large, you can see that it is a country called Costa Atlantica, and since the population is very small, 623, this large number comes out. Therefore, let's look at only data up to 99.5 quantiles.


```python
percentile_99 = np.percentile(df_hospitalization["hosp/pop"], 99.5)
percentile_99
```




    1.4660090896687556



The 99.5% percentile of the number of hospitalizations per 1000 people is about 1.47.


```python
hospital_median = df_hospitalization["hosp/pop"].median()
```


```python
plt.figure(figsize = (30, 8))
sns.distplot(df_hospitalization[(df_hospitalization["hosp/pop"] <= percentile_99)]["hosp/pop"])
plt.axvline(x = hospital_median, color = "red")
plt.annotate(f'Median = {round(hospital_median, 4)}', xy=(hospital_median + 0.01, 8), fontsize = 15, color = "red")
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_36_0.png)
    


The histogram above shows the distribution of the number of hospitalizations per 1000 population excluding values above 99.5 percentile. More than half show a figure of 0.1 per 1000 population. The median number of hospitalizations per 1000 people is about 0.088.

## <font color='#8B0000'> Q4 Create a visualization that shows the  number of tests per day in the United States and indicate the median value on your visualization.</font>


```python
US = df_covid_country_level[df_covid_country_level.administrative_area_level_1 == "United States"].sort_values("date")
```


```python
US_test = US[["date", "tests"]].rename(columns = {"tests" : "cum_tests"})
```


```python
US_test["daily_tests"] = US_test.cum_tests.diff().fillna(US_test['cum_tests'])
US_test = US_test[["date", "daily_tests", "cum_tests"]].dropna()
```


```python
US_test["daily_tests_moving_avg"] = US_test.daily_tests.rolling(7).mean()
```


```python
US_test
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>date</th>
      <th>daily_tests</th>
      <th>cum_tests</th>
      <th>daily_tests_moving_avg</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>159337</th>
      <td>2020-03-01</td>
      <td>348.0</td>
      <td>348.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>159338</th>
      <td>2020-03-02</td>
      <td>514.0</td>
      <td>862.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>159339</th>
      <td>2020-03-03</td>
      <td>622.0</td>
      <td>1484.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>159340</th>
      <td>2020-03-04</td>
      <td>887.0</td>
      <td>2371.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>159341</th>
      <td>2020-03-05</td>
      <td>1201.0</td>
      <td>3572.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>160035</th>
      <td>2022-01-28</td>
      <td>1725137.0</td>
      <td>783594943.0</td>
      <td>1.650536e+06</td>
    </tr>
    <tr>
      <th>160036</th>
      <td>2022-01-29</td>
      <td>1121147.0</td>
      <td>784716090.0</td>
      <td>1.571547e+06</td>
    </tr>
    <tr>
      <th>160037</th>
      <td>2022-01-30</td>
      <td>689304.0</td>
      <td>785405394.0</td>
      <td>1.514444e+06</td>
    </tr>
    <tr>
      <th>160038</th>
      <td>2022-01-31</td>
      <td>1068185.0</td>
      <td>786473579.0</td>
      <td>1.460625e+06</td>
    </tr>
    <tr>
      <th>160039</th>
      <td>2022-02-01</td>
      <td>1347217.0</td>
      <td>787820796.0</td>
      <td>1.397621e+06</td>
    </tr>
  </tbody>
</table>
<p>703 rows Ã— 4 columns</p>
</div>




```python
us_daily_test_median = US_test.daily_tests.median()
```


```python
plt.figure(figsize = (30, 8))
sns.lineplot(x = "date", y = "daily_tests_moving_avg", color = "blue", linewidth = 2, \
             data = US_test)
sns.lineplot(x = "date", y = "daily_tests", color = "tab:blue", alpha = 0.3, \
             data = US_test)
plt.axhline(y = us_daily_test_median, color = "red")
plt.annotate(f'Median = {us_daily_test_median}', xy=(datestr2num("2020-03-01"), us_daily_test_median + 100000), fontsize = 15, color = "red")
plt.xlabel("Date", fontsize = 16)
plt.ylabel("The number of tests", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_45_0.png)
    


In the graph above, light blue is the number of tests per day, and dark blue is the smoothed graph of the light blue graph using the 7-day rolling average. We can check the overall trend by looking at the smoothed graph. It shows an increasing trend until January 2021 and then shows a decreasing trend until July 2021. And again, it shows an increasing trend from July 2021, then sharply increases on January 22, and has since decreased. The median number of tests per day in the United States is 1,040,682.

**For questions below:**
- You will have to call the covid19() function again **with parameters specific to Canada**. 
- Set the parameter <code>level = 2</code> in the call to covid19().


```python
canada,src = covid19("CAN",level = 2)
```

    We have invested a lot of time and effort in creating COVID-19 Data Hub, please cite the following when using it:
    
    	[1mGuidotti, E., Ardia, D., (2020), "COVID-19 Data Hub", Journal of Open Source Software 5(51):2376, doi: 10.21105/joss.02376.[0m
    
    A BibTeX entry for LaTeX users is
    
    	@Article{,
    		title = {COVID-19 Data Hub},
    		year = {2020},
    		doi = {10.21105/joss.02376},
    		author = {Emanuele Guidotti and David Ardia},
    		journal = {Journal of Open Source Software},
    		volume = {5},
    		number = {51},
    		pages = {2376},
    	}
    
    [33mTo hide this message use 'verbose = False'.[0m



```python
canada.tail()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>confirmed</th>
      <th>deaths</th>
      <th>recovered</th>
      <th>tests</th>
      <th>vaccines</th>
      <th>people_vaccinated</th>
      <th>people_fully_vaccinated</th>
      <th>hosp</th>
      <th>...</th>
      <th>iso_alpha_3</th>
      <th>iso_alpha_2</th>
      <th>iso_numeric</th>
      <th>iso_currency</th>
      <th>key_local</th>
      <th>key_google_mobility</th>
      <th>key_apple_mobility</th>
      <th>key_jhu_csse</th>
      <th>key_nuts</th>
      <th>key_gadm</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>496252</th>
      <td>eef40c88</td>
      <td>2022-02-04</td>
      <td>6550.0</td>
      <td>17.0</td>
      <td>5581.0</td>
      <td>39811.0</td>
      <td>96926.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>CAN</td>
      <td>CA</td>
      <td>124.0</td>
      <td>CAD</td>
      <td>61</td>
      <td>ChIJDcHTs_Q4EVERjVnGRNguMhk</td>
      <td>Northwest Territories</td>
      <td>CANT</td>
      <td>NaN</td>
      <td>CAN.6_1</td>
    </tr>
    <tr>
      <th>496253</th>
      <td>eef40c88</td>
      <td>2022-02-05</td>
      <td>6550.0</td>
      <td>17.0</td>
      <td>5581.0</td>
      <td>39852.0</td>
      <td>96926.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>CAN</td>
      <td>CA</td>
      <td>124.0</td>
      <td>CAD</td>
      <td>61</td>
      <td>ChIJDcHTs_Q4EVERjVnGRNguMhk</td>
      <td>Northwest Territories</td>
      <td>CANT</td>
      <td>NaN</td>
      <td>CAN.6_1</td>
    </tr>
    <tr>
      <th>496254</th>
      <td>eef40c88</td>
      <td>2022-02-06</td>
      <td>6550.0</td>
      <td>17.0</td>
      <td>5581.0</td>
      <td>39852.0</td>
      <td>96926.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>CAN</td>
      <td>CA</td>
      <td>124.0</td>
      <td>CAD</td>
      <td>61</td>
      <td>ChIJDcHTs_Q4EVERjVnGRNguMhk</td>
      <td>Northwest Territories</td>
      <td>CANT</td>
      <td>NaN</td>
      <td>CAN.6_1</td>
    </tr>
    <tr>
      <th>496255</th>
      <td>eef40c88</td>
      <td>2022-02-07</td>
      <td>6846.0</td>
      <td>17.0</td>
      <td>5925.0</td>
      <td>39878.0</td>
      <td>97798.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>CAN</td>
      <td>CA</td>
      <td>124.0</td>
      <td>CAD</td>
      <td>61</td>
      <td>ChIJDcHTs_Q4EVERjVnGRNguMhk</td>
      <td>Northwest Territories</td>
      <td>CANT</td>
      <td>NaN</td>
      <td>CAN.6_1</td>
    </tr>
    <tr>
      <th>496256</th>
      <td>eef40c88</td>
      <td>2022-02-08</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>97798.0</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>...</td>
      <td>CAN</td>
      <td>CA</td>
      <td>124.0</td>
      <td>CAD</td>
      <td>61</td>
      <td>ChIJDcHTs_Q4EVERjVnGRNguMhk</td>
      <td>Northwest Territories</td>
      <td>CANT</td>
      <td>NaN</td>
      <td>CAN.6_1</td>
    </tr>
  </tbody>
</table>
<p>5 rows Ã— 47 columns</p>
</div>



## <font color='#8B0000'> Q5 Create a bar plot to show the number of tests conducted in each province.  </font>
Order the provinces from west to east (use your best judgement for cases where the order is unclear).  Which Canadian province that has conducted the most tests?


```python
canada.columns
```




    Index(['id', 'date', 'confirmed', 'deaths', 'recovered', 'tests', 'vaccines',
           'people_vaccinated', 'people_fully_vaccinated', 'hosp', 'icu', 'vent',
           'school_closing', 'workplace_closing', 'cancel_events',
           'gatherings_restrictions', 'transport_closing',
           'stay_home_restrictions', 'internal_movement_restrictions',
           'international_movement_restrictions', 'information_campaigns',
           'testing_policy', 'contact_tracing', 'facial_coverings',
           'vaccination_policy', 'elderly_people_protection',
           'government_response_index', 'stringency_index',
           'containment_health_index', 'economic_support_index',
           'administrative_area_level', 'administrative_area_level_1',
           'administrative_area_level_2', 'administrative_area_level_3',
           'latitude', 'longitude', 'population', 'iso_alpha_3', 'iso_alpha_2',
           'iso_numeric', 'iso_currency', 'key_local', 'key_google_mobility',
           'key_apple_mobility', 'key_jhu_csse', 'key_nuts', 'key_gadm'],
          dtype='object')




```python
canada.administrative_area_level_2.unique()
```




    array(['Prince Edward Island', 'Manitoba', 'Yukon', 'Nunavut', 'Ontario',
           'Quebec', 'Nova Scotia', 'British Columbia',
           'Newfoundland and Labrador', 'New Brunswick', 'Saskatchewan',
           'Alberta', 'Northwest Territories'], dtype=object)




```python
canada_test_conducted = canada[["id", "date", "tests", "administrative_area_level_2", "latitude", "longitude", "population"]].rename(columns = {"administrative_area_level_2" : "province"})
canada_test_conducted.dropna(inplace = True)
```


```python
canada_test_conducted.sort_values(["province","date"], ascending = [True, False])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>tests</th>
      <th>province</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>population</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>475439</th>
      <td>e61d6191</td>
      <td>2022-02-07</td>
      <td>6763655.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
    </tr>
    <tr>
      <th>475438</th>
      <td>e61d6191</td>
      <td>2022-02-06</td>
      <td>6746196.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
    </tr>
    <tr>
      <th>475437</th>
      <td>e61d6191</td>
      <td>2022-02-05</td>
      <td>6746196.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
    </tr>
    <tr>
      <th>475436</th>
      <td>e61d6191</td>
      <td>2022-02-04</td>
      <td>6746196.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
    </tr>
    <tr>
      <th>475435</th>
      <td>e61d6191</td>
      <td>2022-02-03</td>
      <td>6739970.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>124171</th>
      <td>38791b01</td>
      <td>2020-03-15</td>
      <td>49.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
    </tr>
    <tr>
      <th>124170</th>
      <td>38791b01</td>
      <td>2020-03-14</td>
      <td>37.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
    </tr>
    <tr>
      <th>124169</th>
      <td>38791b01</td>
      <td>2020-03-13</td>
      <td>36.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
    </tr>
    <tr>
      <th>124168</th>
      <td>38791b01</td>
      <td>2020-03-12</td>
      <td>34.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
    </tr>
    <tr>
      <th>124167</th>
      <td>38791b01</td>
      <td>2020-03-11</td>
      <td>23.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
    </tr>
  </tbody>
</table>
<p>9128 rows Ã— 7 columns</p>
</div>




```python
canada_test_conducted["date_order"] = canada_test_conducted.sort_values(["province","date"], ascending = [True, False]).groupby("province").cumcount() + 1
```


```python
canada_test_conducted[canada_test_conducted.date_order == 1].sort_values(["longitude", "latitude"])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>tests</th>
      <th>province</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>population</th>
      <th>date_order</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>124865</th>
      <td>38791b01</td>
      <td>2022-02-07</td>
      <td>9129.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
      <td>1</td>
    </tr>
    <tr>
      <th>407259</th>
      <td>c229681f</td>
      <td>2022-02-07</td>
      <td>5495428.0</td>
      <td>British Columbia</td>
      <td>54.499851</td>
      <td>-124.993506</td>
      <td>5110917</td>
      <td>1</td>
    </tr>
    <tr>
      <th>496255</th>
      <td>eef40c88</td>
      <td>2022-02-07</td>
      <td>39878.0</td>
      <td>Northwest Territories</td>
      <td>65.280365</td>
      <td>-121.562220</td>
      <td>44904</td>
      <td>1</td>
    </tr>
    <tr>
      <th>475439</th>
      <td>e61d6191</td>
      <td>2022-02-07</td>
      <td>6763655.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
      <td>1</td>
    </tr>
    <tr>
      <th>474047</th>
      <td>e4c07903</td>
      <td>2022-02-07</td>
      <td>1452358.0</td>
      <td>Saskatchewan</td>
      <td>54.500038</td>
      <td>-105.927063</td>
      <td>1181666</td>
      <td>1</td>
    </tr>
    <tr>
      <th>264912</th>
      <td>7fc88543</td>
      <td>2022-02-07</td>
      <td>32179.0</td>
      <td>Nunavut</td>
      <td>66.001041</td>
      <td>-100.263618</td>
      <td>38780</td>
      <td>1</td>
    </tr>
    <tr>
      <th>99343</th>
      <td>2a9fd65a</td>
      <td>2022-02-07</td>
      <td>1434252.0</td>
      <td>Manitoba</td>
      <td>54.510344</td>
      <td>-97.212207</td>
      <td>1377517</td>
      <td>1</td>
    </tr>
    <tr>
      <th>276313</th>
      <td>83fc0fa9</td>
      <td>2022-02-07</td>
      <td>22606233.0</td>
      <td>Ontario</td>
      <td>49.269156</td>
      <td>-87.166464</td>
      <td>14711827</td>
      <td>1</td>
    </tr>
    <tr>
      <th>347935</th>
      <td>a7ce33b9</td>
      <td>2022-02-07</td>
      <td>16015314.0</td>
      <td>Quebec</td>
      <td>53.889046</td>
      <td>-73.288937</td>
      <td>8537674</td>
      <td>1</td>
    </tr>
    <tr>
      <th>443254</th>
      <td>d177e539</td>
      <td>2022-02-07</td>
      <td>704856.0</td>
      <td>New Brunswick</td>
      <td>46.551245</td>
      <td>-66.411970</td>
      <td>779993</td>
      <td>1</td>
    </tr>
    <tr>
      <th>390749</th>
      <td>b91ff4d1</td>
      <td>2022-02-07</td>
      <td>1728364.0</td>
      <td>Nova Scotia</td>
      <td>44.727022</td>
      <td>-64.602949</td>
      <td>977457</td>
      <td>1</td>
    </tr>
    <tr>
      <th>4180</th>
      <td>015d95fc</td>
      <td>2022-02-07</td>
      <td>255565.0</td>
      <td>Prince Edward Island</td>
      <td>46.503836</td>
      <td>-63.615584</td>
      <td>158158</td>
      <td>1</td>
    </tr>
    <tr>
      <th>441298</th>
      <td>d07806cb</td>
      <td>2022-02-07</td>
      <td>551866.0</td>
      <td>Newfoundland and Labrador</td>
      <td>49.120554</td>
      <td>-56.692576</td>
      <td>521365</td>
      <td>1</td>
    </tr>
  </tbody>
</table>
</div>



Since the test column is a cumulative number, if you check the data of the last date in each province, you can check the number of tests conducted in each province. 


```python
plt.figure(figsize = (30, 8))
sns.barplot(x = "province", y = "tests", \
            data = canada_test_conducted[canada_test_conducted.date_order == 1].sort_values(["longitude", "latitude"]))
plt.ylabel("The number of tests conducted")
plt.xlabel("Province")
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_58_0.png)
    


In the above bar chart, provinces are sorted in the order from west to east by sorting longitude first, and then latitude values. Looking at the bar chart above, it can be seen that Ontario and Quebec tested overwhelmingly, and there were more tests in the west than in the east. However, since this is an interpretation that does not take into account the population of each province, it is necessary to consider the population as well.

## <font color='#8B0000'> Q6 Create a bar plot that shows the number of tests conducted per 1000 people for each province in Canada.</font>
How would you interpret the results of this bar plot given the results of bar plot in question 5. 


```python
canada_test_conducted.loc[canada_test_conducted.date_order == 1, "tests/pop"] = canada_test_conducted[canada_test_conducted.date_order == 1].tests \
                                                                            / canada_test_conducted[canada_test_conducted.date_order == 1].population \
                                                                            * 1000
```


```python
canada_test_conducted[canada_test_conducted.date_order == 1].sort_values(["longitude", "latitude"])
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>tests</th>
      <th>province</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>population</th>
      <th>date_order</th>
      <th>tests/pop</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>124865</th>
      <td>38791b01</td>
      <td>2022-02-07</td>
      <td>9129.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>41078</td>
      <td>1</td>
      <td>222.235747</td>
    </tr>
    <tr>
      <th>407259</th>
      <td>c229681f</td>
      <td>2022-02-07</td>
      <td>5495428.0</td>
      <td>British Columbia</td>
      <td>54.499851</td>
      <td>-124.993506</td>
      <td>5110917</td>
      <td>1</td>
      <td>1075.233270</td>
    </tr>
    <tr>
      <th>496255</th>
      <td>eef40c88</td>
      <td>2022-02-07</td>
      <td>39878.0</td>
      <td>Northwest Territories</td>
      <td>65.280365</td>
      <td>-121.562220</td>
      <td>44904</td>
      <td>1</td>
      <td>888.072332</td>
    </tr>
    <tr>
      <th>475439</th>
      <td>e61d6191</td>
      <td>2022-02-07</td>
      <td>6763655.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>4413146</td>
      <td>1</td>
      <td>1532.615282</td>
    </tr>
    <tr>
      <th>474047</th>
      <td>e4c07903</td>
      <td>2022-02-07</td>
      <td>1452358.0</td>
      <td>Saskatchewan</td>
      <td>54.500038</td>
      <td>-105.927063</td>
      <td>1181666</td>
      <td>1</td>
      <td>1229.076575</td>
    </tr>
    <tr>
      <th>264912</th>
      <td>7fc88543</td>
      <td>2022-02-07</td>
      <td>32179.0</td>
      <td>Nunavut</td>
      <td>66.001041</td>
      <td>-100.263618</td>
      <td>38780</td>
      <td>1</td>
      <td>829.783394</td>
    </tr>
    <tr>
      <th>99343</th>
      <td>2a9fd65a</td>
      <td>2022-02-07</td>
      <td>1434252.0</td>
      <td>Manitoba</td>
      <td>54.510344</td>
      <td>-97.212207</td>
      <td>1377517</td>
      <td>1</td>
      <td>1041.186425</td>
    </tr>
    <tr>
      <th>276313</th>
      <td>83fc0fa9</td>
      <td>2022-02-07</td>
      <td>22606233.0</td>
      <td>Ontario</td>
      <td>49.269156</td>
      <td>-87.166464</td>
      <td>14711827</td>
      <td>1</td>
      <td>1536.602694</td>
    </tr>
    <tr>
      <th>347935</th>
      <td>a7ce33b9</td>
      <td>2022-02-07</td>
      <td>16015314.0</td>
      <td>Quebec</td>
      <td>53.889046</td>
      <td>-73.288937</td>
      <td>8537674</td>
      <td>1</td>
      <td>1875.840422</td>
    </tr>
    <tr>
      <th>443254</th>
      <td>d177e539</td>
      <td>2022-02-07</td>
      <td>704856.0</td>
      <td>New Brunswick</td>
      <td>46.551245</td>
      <td>-66.411970</td>
      <td>779993</td>
      <td>1</td>
      <td>903.669648</td>
    </tr>
    <tr>
      <th>390749</th>
      <td>b91ff4d1</td>
      <td>2022-02-07</td>
      <td>1728364.0</td>
      <td>Nova Scotia</td>
      <td>44.727022</td>
      <td>-64.602949</td>
      <td>977457</td>
      <td>1</td>
      <td>1768.225098</td>
    </tr>
    <tr>
      <th>4180</th>
      <td>015d95fc</td>
      <td>2022-02-07</td>
      <td>255565.0</td>
      <td>Prince Edward Island</td>
      <td>46.503836</td>
      <td>-63.615584</td>
      <td>158158</td>
      <td>1</td>
      <td>1615.884116</td>
    </tr>
    <tr>
      <th>441298</th>
      <td>d07806cb</td>
      <td>2022-02-07</td>
      <td>551866.0</td>
      <td>Newfoundland and Labrador</td>
      <td>49.120554</td>
      <td>-56.692576</td>
      <td>521365</td>
      <td>1</td>
      <td>1058.502201</td>
    </tr>
  </tbody>
</table>
</div>




```python
plt.figure(figsize = (30, 8))
sns.barplot(x = "province", y = "tests/pop", \
            data = canada_test_conducted[canada_test_conducted.date_order == 1].sort_values(["longitude", "latitude"]))
plt.ylabel("The number of tests conducted pero 1000 people")
plt.xlabel("Province")
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_63_0.png)
    


In the graph in Q5, it came out that Ontario and Quebec had an overwhelming number of tests, but if you check the graph in Q6, you can confirm that this was because the population of the two provinces was overwhelmingly large. Comparing the number of tests per 1000 population, it can be seen that Ontario is lower than Nova Scotia and Prince Edward Island. In addition, it can be seen that the number of tests per 1000 population is slightly higher in the east than in the west.

## <font color='#8B0000'> Q7 Create a visualization that shows which Canadian province has the highest recovery rate. </font>
Recovery rate is calculated as the number of recovered cases divided by the number of confirmed cases.


```python
canada_recovery = canada[["id", "date", "confirmed", "recovered", "administrative_area_level_2", "latitude", "longitude"]].rename(columns = {"administrative_area_level_2" : "province"})
canada_recovery.dropna(inplace = True)
```


```python
canada_recovery["date_order"] = canada_recovery.sort_values(["province","date"], ascending = [True, False]).groupby("province").cumcount() + 1
```


```python
canada_recovery.loc[canada_recovery.date_order == 1, "recovery_rate"] = canada_recovery[canada_recovery.date_order == 1].recovered \
                                                                            / canada_recovery[canada_recovery.date_order == 1].confirmed
```


```python
canada_recovery.loc[canada_recovery.date_order == 1].sort_values("recovery_rate", ascending = False)
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>id</th>
      <th>date</th>
      <th>confirmed</th>
      <th>recovered</th>
      <th>province</th>
      <th>latitude</th>
      <th>longitude</th>
      <th>date_order</th>
      <th>recovery_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>124865</th>
      <td>38791b01</td>
      <td>2022-02-07</td>
      <td>3235.0</td>
      <td>3105.0</td>
      <td>Yukon</td>
      <td>64.819450</td>
      <td>-136.804579</td>
      <td>1</td>
      <td>0.959815</td>
    </tr>
    <tr>
      <th>276313</th>
      <td>83fc0fa9</td>
      <td>2022-02-07</td>
      <td>1056149.0</td>
      <td>1010878.0</td>
      <td>Ontario</td>
      <td>49.269156</td>
      <td>-87.166464</td>
      <td>1</td>
      <td>0.957136</td>
    </tr>
    <tr>
      <th>347935</th>
      <td>a7ce33b9</td>
      <td>2022-02-07</td>
      <td>883192.0</td>
      <td>834633.0</td>
      <td>Quebec</td>
      <td>53.889046</td>
      <td>-73.288937</td>
      <td>1</td>
      <td>0.945019</td>
    </tr>
    <tr>
      <th>475439</th>
      <td>e61d6191</td>
      <td>2022-02-07</td>
      <td>508051.0</td>
      <td>474284.0</td>
      <td>Alberta</td>
      <td>54.500614</td>
      <td>-115.002842</td>
      <td>1</td>
      <td>0.933536</td>
    </tr>
    <tr>
      <th>407259</th>
      <td>c229681f</td>
      <td>2022-02-07</td>
      <td>333925.0</td>
      <td>306419.0</td>
      <td>British Columbia</td>
      <td>54.499851</td>
      <td>-124.993506</td>
      <td>1</td>
      <td>0.917628</td>
    </tr>
    <tr>
      <th>474047</th>
      <td>e4c07903</td>
      <td>2022-02-07</td>
      <td>123258.0</td>
      <td>113023.0</td>
      <td>Saskatchewan</td>
      <td>54.500038</td>
      <td>-105.927063</td>
      <td>1</td>
      <td>0.916963</td>
    </tr>
    <tr>
      <th>441298</th>
      <td>d07806cb</td>
      <td>2022-02-07</td>
      <td>18740.0</td>
      <td>17156.0</td>
      <td>Newfoundland and Labrador</td>
      <td>49.120554</td>
      <td>-56.692576</td>
      <td>1</td>
      <td>0.915475</td>
    </tr>
    <tr>
      <th>390749</th>
      <td>b91ff4d1</td>
      <td>2022-02-07</td>
      <td>40767.0</td>
      <td>37300.0</td>
      <td>Nova Scotia</td>
      <td>44.727022</td>
      <td>-64.602949</td>
      <td>1</td>
      <td>0.914956</td>
    </tr>
    <tr>
      <th>443254</th>
      <td>d177e539</td>
      <td>2022-02-07</td>
      <td>31017.0</td>
      <td>27298.0</td>
      <td>New Brunswick</td>
      <td>46.551245</td>
      <td>-66.411970</td>
      <td>1</td>
      <td>0.880098</td>
    </tr>
    <tr>
      <th>496255</th>
      <td>eef40c88</td>
      <td>2022-02-07</td>
      <td>6846.0</td>
      <td>5925.0</td>
      <td>Northwest Territories</td>
      <td>65.280365</td>
      <td>-121.562220</td>
      <td>1</td>
      <td>0.865469</td>
    </tr>
    <tr>
      <th>99343</th>
      <td>2a9fd65a</td>
      <td>2022-02-07</td>
      <td>123739.0</td>
      <td>103595.0</td>
      <td>Manitoba</td>
      <td>54.510344</td>
      <td>-97.212207</td>
      <td>1</td>
      <td>0.837206</td>
    </tr>
    <tr>
      <th>4180</th>
      <td>015d95fc</td>
      <td>2022-02-07</td>
      <td>9104.0</td>
      <td>7268.0</td>
      <td>Prince Edward Island</td>
      <td>46.503836</td>
      <td>-63.615584</td>
      <td>1</td>
      <td>0.798330</td>
    </tr>
    <tr>
      <th>264912</th>
      <td>7fc88543</td>
      <td>2022-02-07</td>
      <td>1989.0</td>
      <td>1444.0</td>
      <td>Nunavut</td>
      <td>66.001041</td>
      <td>-100.263618</td>
      <td>1</td>
      <td>0.725993</td>
    </tr>
  </tbody>
</table>
</div>




```python
plt.figure(figsize = (30, 8))
sns.barplot(x = "province", y = "recovery_rate", \
            data = canada_recovery[canada_recovery.date_order == 1].sort_values(["longitude", "latitude"]))
plt.ylabel("Recovery rate = # of recovered cases / # of confirmed cases")
plt.xlabel("Province")
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_70_0.png)
    


Yukon has the highest recovery rate of 0.96, Nunavut has the lowest 0.73. Yukon had the lowest number of tests per 1000 population but the highest recovery rate. In Nunavut, the number of tests per 1000 people was 829, which was much lower than in other provinces, but the recovery rate was also the lowest.

## <font color='#8B0000'> Q8 Create visualizations that show the impacts of _at least_ three policy measures on mortality or infection rates.</font>


See https://covid19datahub.io/articles/doc/data.html for descriptions of the available policy measures.  You are not limited to histograms and bar charts.  Remember that you can use subplots!


**Gatherings restrictions**

0 - no restrictions         
1 - restrictions on very large gatherings (the limit is above 1000 people)          
2 - restrictions on gatherings between 101-1000 people        
3 - restrictions on gatherings between 11-100 people           
4 - restrictions on gatherings of 10 people or less       

If gathering restrictions are targeted to a specific geographical region, then they have a negative value. Otherwise, if they are a general policy that is applied across the whole country/territory, then they have positive values. Since I am only interested in the impacts of the general policy on infection rates, I will focus on the data that have the positive gathering_restirctions values.


```python
canada_gatherings_restriction = canada[["date", "confirmed", "population", "gatherings_restrictions", "administrative_area_level_2"]].rename(columns = {"administrative_area_level_2" : "province", "confirmed" : "cum_confirmed"})
canada_gatherings_restriction = canada_gatherings_restriction[canada_gatherings_restriction.cum_confirmed.isnull() == False]
canada_gatherings_restriction = canada_gatherings_restriction[canada_gatherings_restriction.gatherings_restrictions >= 0].sort_values(["province", "date"])
canada_gatherings_restriction["daily_confirmed"] = canada_gatherings_restriction.sort_values(["province", "date"]).groupby("province").cum_confirmed.diff().fillna(canada_gatherings_restriction.cum_confirmed)
canada_gatherings_restriction = canada_gatherings_restriction[canada_gatherings_restriction.daily_confirmed >= 0]
canada_gatherings_restriction = canada_gatherings_restriction[["date", "province", "population", "gatherings_restrictions", "daily_confirmed", "cum_confirmed"]]
```


```python
canada_gatherings_restriction_infection_rate = canada_gatherings_restriction.groupby(["gatherings_restrictions", "date"]).sum()[["daily_confirmed", "population"]].reset_index() 
canada_gatherings_restriction_infection_rate["infection_rate"] = canada_gatherings_restriction_infection_rate.daily_confirmed / canada_gatherings_restriction_infection_rate.population * 100
canada_gatherings_restriction_infection_rate
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>gatherings_restrictions</th>
      <th>date</th>
      <th>daily_confirmed</th>
      <th>population</th>
      <th>infection_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>2020-01-31</td>
      <td>4.0</td>
      <td>19822744</td>
      <td>0.000020</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>2020-02-08</td>
      <td>3.0</td>
      <td>19822744</td>
      <td>0.000015</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>2020-02-16</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>2020-02-21</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>2020-02-24</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1854</th>
      <td>4.0</td>
      <td>2022-01-31</td>
      <td>2073.0</td>
      <td>4499128</td>
      <td>0.046076</td>
    </tr>
    <tr>
      <th>1855</th>
      <td>4.0</td>
      <td>2022-02-01</td>
      <td>2188.0</td>
      <td>4458050</td>
      <td>0.049080</td>
    </tr>
    <tr>
      <th>1856</th>
      <td>4.0</td>
      <td>2022-02-02</td>
      <td>3172.0</td>
      <td>4458050</td>
      <td>0.071152</td>
    </tr>
    <tr>
      <th>1857</th>
      <td>4.0</td>
      <td>2022-02-03</td>
      <td>2512.0</td>
      <td>4458050</td>
      <td>0.056348</td>
    </tr>
    <tr>
      <th>1858</th>
      <td>4.0</td>
      <td>2022-02-04</td>
      <td>2273.0</td>
      <td>4458050</td>
      <td>0.050986</td>
    </tr>
  </tbody>
</table>
<p>1859 rows Ã— 5 columns</p>
</div>




```python
plt.figure(figsize = (20, 8))
sns.boxplot(data = canada_gatherings_restriction_infection_rate, x = "gatherings_restrictions", y = "infection_rate", showfliers = False)
plt.xlabel("Gathering restrictions", fontsize = 16)
plt.ylabel("Infection rate (%) = confirmed cases / population * 100", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_78_0.png)
    


The graph above shows a box plot of the daily infection rate for each gathering restriction policy. It can be seen that the infection rate was high when there was no restriction, but when the restriction was level 1 to 3, the infection rate was significantly reduced. However, when the restriction was the highest at level 4, the infection rate was rather high.


```python
canada_gatherings_restriction_infection_rate["infection_rate_moving_avg"] = canada_gatherings_restriction_infection_rate.sort_values(["gatherings_restrictions","date"]).groupby("gatherings_restrictions").infection_rate.rolling(7).mean().reset_index().infection_rate
```


```python
plt.figure(figsize = (30, 8))
sns.lineplot(data = canada_gatherings_restriction_infection_rate, x = "date", y = "infection_rate_moving_avg", hue = "gatherings_restrictions")
plt.xlabel("date", fontsize = 16)
plt.ylabel("Infection rate (%) = confirmed cases / population * 100", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_81_0.png)
    


It is a graph showing the infection rate for each restriction level over time. All five levels show a similar trend, but it can be seen that the infection rate is particularly high in the 4th level of restriction area from October 2020 to June 2021. In addition, the infection rate was particularly high in the level 0 restricted area from July 2021 to December 2021.

**Stay home restrictions**

0 - no measures         
1 - recommend not leaving house       
2 - require not leaving house with exceptions for daily exercise, grocery shopping, and â€˜essentialâ€™ trips        
3 - require not leaving house with minimal exceptions (eg allowed to leave once a week, or only one person can leave at a time, etc)          

If stay-home restrictions are targeted to a specific geographical region, then they have a negative value. Otherwise, if they are a general policy that is applied across the whole country/territory, then they have positive values. Since I am only interested in the impacts of the general policy on infection rates, I will focus on the data that have positive stay-home restrictions values.


```python
canada_stayhome_restriction = canada[["date", "confirmed", "population", "stay_home_restrictions", "administrative_area_level_2"]].rename(columns = {"administrative_area_level_2" : "province", "confirmed" : "cum_confirmed"})
canada_stayhome_restriction = canada_stayhome_restriction[canada_stayhome_restriction.cum_confirmed.isnull() == False]
canada_stayhome_restriction = canada_stayhome_restriction[canada_stayhome_restriction.stay_home_restrictions >= 0].sort_values(["province", "date"])
canada_stayhome_restriction["daily_confirmed"] = canada_stayhome_restriction.sort_values(["province", "date"]).groupby("province").cum_confirmed.diff().fillna(canada_stayhome_restriction.cum_confirmed)
canada_stayhome_restriction = canada_stayhome_restriction[canada_stayhome_restriction.daily_confirmed >= 0]
canada_stayhome_restriction = canada_stayhome_restriction[["date", "province", "population", "stay_home_restrictions", "daily_confirmed", "cum_confirmed"]]
```


```python
canada_stayhome_restriction_infection_rate = canada_stayhome_restriction.groupby(["stay_home_restrictions", "date"]).sum()[["daily_confirmed", "population"]].reset_index() 
canada_stayhome_restriction_infection_rate["infection_rate"] = canada_stayhome_restriction_infection_rate.daily_confirmed / canada_stayhome_restriction_infection_rate.population * 100
canada_stayhome_restriction_infection_rate
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>stay_home_restrictions</th>
      <th>date</th>
      <th>daily_confirmed</th>
      <th>population</th>
      <th>infection_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>2020-01-31</td>
      <td>4.0</td>
      <td>19822744</td>
      <td>0.000020</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>2020-02-08</td>
      <td>3.0</td>
      <td>19822744</td>
      <td>0.000015</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>2020-02-16</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>2020-02-21</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>2020-02-24</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1389</th>
      <td>2.0</td>
      <td>2022-01-12</td>
      <td>8351.0</td>
      <td>8537674</td>
      <td>0.097814</td>
    </tr>
    <tr>
      <th>1390</th>
      <td>2.0</td>
      <td>2022-01-13</td>
      <td>8793.0</td>
      <td>8537674</td>
      <td>0.102991</td>
    </tr>
    <tr>
      <th>1391</th>
      <td>2.0</td>
      <td>2022-01-14</td>
      <td>7382.0</td>
      <td>8537674</td>
      <td>0.086464</td>
    </tr>
    <tr>
      <th>1392</th>
      <td>2.0</td>
      <td>2022-01-15</td>
      <td>6705.0</td>
      <td>8537674</td>
      <td>0.078534</td>
    </tr>
    <tr>
      <th>1393</th>
      <td>2.0</td>
      <td>2022-01-16</td>
      <td>5946.0</td>
      <td>8537674</td>
      <td>0.069644</td>
    </tr>
  </tbody>
</table>
<p>1394 rows Ã— 5 columns</p>
</div>




```python
plt.figure(figsize = (20, 8))
sns.boxplot(data = canada_stayhome_restriction_infection_rate, x = "stay_home_restrictions", y = "infection_rate", showfliers = False)
plt.xlabel("Stay home restrictions", fontsize = 16)
plt.ylabel("Infection rate (%) = confirmed cases / population * 100", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_88_0.png)
    


The graph above shows a box plot of the daily infection rate for each stay-home restriction. Contrary to our common sense, it can be seen that the higher the restriction level, the higher the infection rate.


```python
canada_stayhome_restriction_infection_rate["infection_rate_moving_avg"] = canada_stayhome_restriction_infection_rate.sort_values(["stay_home_restrictions","date"]).groupby("stay_home_restrictions").infection_rate.rolling(7).mean().reset_index().infection_rate
```


```python
plt.figure(figsize = (30, 8))
sns.lineplot(data = canada_stayhome_restriction_infection_rate, x = "date", y = "infection_rate_moving_avg", hue = "stay_home_restrictions")
plt.xlabel("date", fontsize = 16)
plt.ylabel("Infection rate (%) = confirmed cases / population * 100", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_91_0.png)
    


The overall trend is similar, but in the case of the second-stage restriction, it can be seen that the infection rate was particularly high from April 2020 to January 2021.

**Transport closing**

0 - no measures           
1 - recommend closing (or significantly reduce volume/route/means of transport available)          
2 - require closing (or prohibit most citizens from using it)         

If transport closing restrictions are targeted to a specific geographical region, then they have a negative value. Otherwise, if they are a general policy that is applied across the whole country/territory, then they have positive values. Since I am only interested in the impacts of the general policy on infection rates, I will focus on the data that have positive transport closing values.


```python
canada_transport_closing = canada[["date", "confirmed", "population", "transport_closing", "administrative_area_level_2"]].rename(columns = {"administrative_area_level_2" : "province", "confirmed" : "cum_confirmed"})
canada_transport_closing = canada_transport_closing[canada_transport_closing.cum_confirmed.isnull() == False]
canada_transport_closing = canada_transport_closing[canada_transport_closing.transport_closing >= 0].sort_values(["province", "date"])
canada_transport_closing["daily_confirmed"] = canada_transport_closing.sort_values(["province", "date"]).groupby("province").cum_confirmed.diff().fillna(canada_transport_closing.cum_confirmed)
canada_transport_closing = canada_transport_closing[canada_transport_closing.daily_confirmed >= 0]
canada_transport_closing = canada_transport_closing[["date", "province", "population", "transport_closing", "daily_confirmed", "cum_confirmed"]]
```


```python
canada_transport_closing_infection_rate = canada_transport_closing.groupby(["transport_closing", "date"]).sum()[["daily_confirmed", "population"]].reset_index() 
canada_transport_closing_infection_rate["infection_rate"] = canada_transport_closing_infection_rate.daily_confirmed / canada_transport_closing_infection_rate.population * 100
canada_transport_closing_infection_rate
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>transport_closing</th>
      <th>date</th>
      <th>daily_confirmed</th>
      <th>population</th>
      <th>infection_rate</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>0.0</td>
      <td>2020-01-31</td>
      <td>4.0</td>
      <td>19822744</td>
      <td>0.000020</td>
    </tr>
    <tr>
      <th>1</th>
      <td>0.0</td>
      <td>2020-02-08</td>
      <td>3.0</td>
      <td>19822744</td>
      <td>0.000015</td>
    </tr>
    <tr>
      <th>2</th>
      <td>0.0</td>
      <td>2020-02-16</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>3</th>
      <td>0.0</td>
      <td>2020-02-21</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>4</th>
      <td>0.0</td>
      <td>2020-02-24</td>
      <td>1.0</td>
      <td>19822744</td>
      <td>0.000005</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>1256</th>
      <td>1.0</td>
      <td>2022-01-27</td>
      <td>378.0</td>
      <td>521365</td>
      <td>0.072502</td>
    </tr>
    <tr>
      <th>1257</th>
      <td>1.0</td>
      <td>2022-01-28</td>
      <td>265.0</td>
      <td>521365</td>
      <td>0.050828</td>
    </tr>
    <tr>
      <th>1258</th>
      <td>1.0</td>
      <td>2022-01-29</td>
      <td>208.0</td>
      <td>521365</td>
      <td>0.039895</td>
    </tr>
    <tr>
      <th>1259</th>
      <td>1.0</td>
      <td>2022-01-30</td>
      <td>210.0</td>
      <td>521365</td>
      <td>0.040279</td>
    </tr>
    <tr>
      <th>1260</th>
      <td>1.0</td>
      <td>2022-01-31</td>
      <td>183.0</td>
      <td>521365</td>
      <td>0.035100</td>
    </tr>
  </tbody>
</table>
<p>1261 rows Ã— 5 columns</p>
</div>




```python
plt.figure(figsize = (20, 8))
sns.boxplot(data = canada_transport_closing_infection_rate, x = "transport_closing", y = "infection_rate", showfliers = False)
plt.xlabel("Transport closing", fontsize = 16)
plt.ylabel("Infection rate (%) = confirmed cases / population * 100", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_98_0.png)
    


The graph above shows a box plot of the daily infection rate for each transport closing restriction. There was no level 2 restriction in Canada. It can be seen that the first level restriction, which only recommends transport closing, has little effect on the infection rate. 


```python
canada_transport_closing_infection_rate["infection_rate_moving_avg"] = canada_transport_closing_infection_rate.sort_values(["transport_closing","date"]).groupby("transport_closing").infection_rate.rolling(7).mean().reset_index().infection_rate
```


```python
plt.figure(figsize = (30, 8))
sns.lineplot(data = canada_transport_closing_infection_rate, x = "date", y = "infection_rate_moving_avg", hue = "transport_closing")
plt.xlabel("date", fontsize = 16)
plt.ylabel("Infection rate (%) = confirmed cases / population * 100", fontsize = 16)
plt.show()
```


    
![png](/assets/images/coursework/SI618/hw3/hw3_upload_101_0.png)
    


Level 0 and Level 1 restrictions show almost no difference in the infection rate over time.
