---
layout: single
title: "2 - 4. EDA - Match in-game shot information"
permalink: /projects/european_soccer_prediction/2.4.eda_match_ingame_shot/
comments: false
author_profile: true
read_time: true
toc: true
toc_label: "Table of Contents"
toc_sticky: true
categories: ["european_soccer_prediction"]
---

```python
import numpy as np 
import pandas as pd 

import sqlite3 as sql 

import matplotlib.pyplot as plt 
import matplotlib.patches as mpatches
import seaborn as sns 
import missingno as msno 

from utils import my_histogram
```


```python
import warnings
warnings.filterwarnings('ignore')
```


```python
pd.set_option('display.max_columns', None)
```


```python
con = sql.connect("../data/database.sqlite")
```


```python
df_match_ingame_shot = pd.read_csv("../data/df_match_ingame_shot.csv")
```


```python
df_match_basic = pd.read_csv("../data/df_match_basic.csv")
```

- Let's analyze the goal and shot information from df_match_ingame_shot and df_match_basic table.


```python
df_match_ingame_shot
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>event_id</th>
      <th>elapsed</th>
      <th>team_api_id</th>
      <th>category</th>
      <th>type</th>
      <th>subtype</th>
      <th>player1_api_id</th>
      <th>player2_api_id</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>489042</td>
      <td>378998</td>
      <td>22</td>
      <td>10261.0</td>
      <td>goal</td>
      <td>n</td>
      <td>header</td>
      <td>37799.0</td>
      <td>38807.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>489042</td>
      <td>379019</td>
      <td>24</td>
      <td>10260.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>24148.0</td>
      <td>24154.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>489043</td>
      <td>375546</td>
      <td>4</td>
      <td>9825.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>26181.0</td>
      <td>39297.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>489044</td>
      <td>378041</td>
      <td>83</td>
      <td>8650.0</td>
      <td>goal</td>
      <td>n</td>
      <td>distance</td>
      <td>30853.0</td>
      <td>30889.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>489045</td>
      <td>376060</td>
      <td>4</td>
      <td>8654.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>23139.0</td>
      <td>36394.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>229033</th>
      <td>2030171</td>
      <td>4940379</td>
      <td>19</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>36130.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>229034</th>
      <td>2030171</td>
      <td>4940624</td>
      <td>44</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>34104.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>229035</th>
      <td>2030171</td>
      <td>4940738</td>
      <td>49</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>107930.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>229036</th>
      <td>2030171</td>
      <td>4940963</td>
      <td>71</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>210065.0</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>229037</th>
      <td>2030171</td>
      <td>4941072</td>
      <td>83</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>629579.0</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>229038 rows × 9 columns</p>
</div>




```python
df_match_basic
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>country_id</th>
      <th>league_id</th>
      <th>season</th>
      <th>stage</th>
      <th>match_date</th>
      <th>home_team_api_id</th>
      <th>away_team_api_id</th>
      <th>home_team_goal</th>
      <th>away_team_goal</th>
      <th>match_result</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>492473</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-17</td>
      <td>9987</td>
      <td>9993</td>
      <td>1</td>
      <td>1</td>
      <td>draw</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492474</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16</td>
      <td>10000</td>
      <td>9994</td>
      <td>0</td>
      <td>0</td>
      <td>draw</td>
    </tr>
    <tr>
      <th>2</th>
      <td>492475</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16</td>
      <td>9984</td>
      <td>8635</td>
      <td>0</td>
      <td>3</td>
      <td>away_win</td>
    </tr>
    <tr>
      <th>3</th>
      <td>492476</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-17</td>
      <td>9991</td>
      <td>9998</td>
      <td>5</td>
      <td>0</td>
      <td>home_win</td>
    </tr>
    <tr>
      <th>4</th>
      <td>492477</td>
      <td>1</td>
      <td>1</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16</td>
      <td>7947</td>
      <td>9985</td>
      <td>1</td>
      <td>3</td>
      <td>away_win</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>24558</td>
      <td>24558</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-22</td>
      <td>10190</td>
      <td>10191</td>
      <td>1</td>
      <td>0</td>
      <td>home_win</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>24558</td>
      <td>24558</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-23</td>
      <td>9824</td>
      <td>10199</td>
      <td>1</td>
      <td>2</td>
      <td>away_win</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>24558</td>
      <td>24558</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-23</td>
      <td>9956</td>
      <td>10179</td>
      <td>2</td>
      <td>0</td>
      <td>home_win</td>
    </tr>
    <tr>
      <th>25977</th>
      <td>1992094</td>
      <td>24558</td>
      <td>24558</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-22</td>
      <td>7896</td>
      <td>10243</td>
      <td>0</td>
      <td>0</td>
      <td>draw</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>24558</td>
      <td>24558</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-23</td>
      <td>10192</td>
      <td>9931</td>
      <td>4</td>
      <td>3</td>
      <td>home_win</td>
    </tr>
  </tbody>
</table>
<p>25979 rows × 11 columns</p>
</div>



- Combine the home team id, away team id, match date, match result, and season information to the df_match_ingame_shot table.


```python
home_info = df_match_basic[["match_api_id", "home_team_api_id", "match_date", "match_result", "season"]].rename(columns = {"home_team_api_id": "team_api_id"})
```


```python
home_info["home_away"] = "home"
```


```python
away_info = df_match_basic[["match_api_id", "away_team_api_id", "match_date", "match_result", "season"]].rename(columns = {"away_team_api_id": "team_api_id"})
```


```python
away_info["home_away"] = "away"
```


```python
home_away_info = pd.concat([home_info, away_info], axis = 0)
```


```python
df_match_ingame_shot = df_match_ingame_shot.merge(home_away_info, how = "left", on = ["match_api_id", "team_api_id"])
df_match_ingame_shot
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>event_id</th>
      <th>elapsed</th>
      <th>team_api_id</th>
      <th>category</th>
      <th>type</th>
      <th>subtype</th>
      <th>player1_api_id</th>
      <th>player2_api_id</th>
      <th>match_date</th>
      <th>match_result</th>
      <th>season</th>
      <th>home_away</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>489042</td>
      <td>378998</td>
      <td>22</td>
      <td>10261.0</td>
      <td>goal</td>
      <td>n</td>
      <td>header</td>
      <td>37799.0</td>
      <td>38807.0</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>away</td>
    </tr>
    <tr>
      <th>1</th>
      <td>489042</td>
      <td>379019</td>
      <td>24</td>
      <td>10260.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>24148.0</td>
      <td>24154.0</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
    </tr>
    <tr>
      <th>2</th>
      <td>489043</td>
      <td>375546</td>
      <td>4</td>
      <td>9825.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>26181.0</td>
      <td>39297.0</td>
      <td>2008-08-16</td>
      <td>home_win</td>
      <td>2008/2009</td>
      <td>home</td>
    </tr>
    <tr>
      <th>3</th>
      <td>489044</td>
      <td>378041</td>
      <td>83</td>
      <td>8650.0</td>
      <td>goal</td>
      <td>n</td>
      <td>distance</td>
      <td>30853.0</td>
      <td>30889.0</td>
      <td>2008-08-16</td>
      <td>away_win</td>
      <td>2008/2009</td>
      <td>away</td>
    </tr>
    <tr>
      <th>4</th>
      <td>489045</td>
      <td>376060</td>
      <td>4</td>
      <td>8654.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>23139.0</td>
      <td>36394.0</td>
      <td>2008-08-16</td>
      <td>home_win</td>
      <td>2008/2009</td>
      <td>home</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>229033</th>
      <td>2030171</td>
      <td>4940379</td>
      <td>19</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>36130.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
    </tr>
    <tr>
      <th>229034</th>
      <td>2030171</td>
      <td>4940624</td>
      <td>44</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>34104.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
    </tr>
    <tr>
      <th>229035</th>
      <td>2030171</td>
      <td>4940738</td>
      <td>49</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>107930.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
    </tr>
    <tr>
      <th>229036</th>
      <td>2030171</td>
      <td>4940963</td>
      <td>71</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>210065.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
    </tr>
    <tr>
      <th>229037</th>
      <td>2030171</td>
      <td>4941072</td>
      <td>83</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>629579.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
    </tr>
  </tbody>
</table>
<p>229038 rows × 13 columns</p>
</div>



- Combine the league name to the df_match_ingame_shot table.


```python
org_league = pd.read_sql(
    "select * from League", con
    )
```


```python
df_match_ingame_shot = df_match_ingame_shot.merge(df_match_basic[["match_api_id", "league_id"]], how = "left", on = "match_api_id")
df_match_ingame_shot = df_match_ingame_shot.merge(org_league.rename(columns = {"id" : "league_id", "name": "league_name"}), 
                                                            how = "left", on = "league_id")
df_match_ingame_shot.drop(["league_id", "country_id"], axis = 1, inplace = True)
```


```python
df_match_ingame_shot
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>event_id</th>
      <th>elapsed</th>
      <th>team_api_id</th>
      <th>category</th>
      <th>type</th>
      <th>subtype</th>
      <th>player1_api_id</th>
      <th>player2_api_id</th>
      <th>match_date</th>
      <th>match_result</th>
      <th>season</th>
      <th>home_away</th>
      <th>league_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>489042</td>
      <td>378998</td>
      <td>22</td>
      <td>10261.0</td>
      <td>goal</td>
      <td>n</td>
      <td>header</td>
      <td>37799.0</td>
      <td>38807.0</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>away</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>1</th>
      <td>489042</td>
      <td>379019</td>
      <td>24</td>
      <td>10260.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>24148.0</td>
      <td>24154.0</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>2</th>
      <td>489043</td>
      <td>375546</td>
      <td>4</td>
      <td>9825.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>26181.0</td>
      <td>39297.0</td>
      <td>2008-08-16</td>
      <td>home_win</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>3</th>
      <td>489044</td>
      <td>378041</td>
      <td>83</td>
      <td>8650.0</td>
      <td>goal</td>
      <td>n</td>
      <td>distance</td>
      <td>30853.0</td>
      <td>30889.0</td>
      <td>2008-08-16</td>
      <td>away_win</td>
      <td>2008/2009</td>
      <td>away</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>4</th>
      <td>489045</td>
      <td>376060</td>
      <td>4</td>
      <td>8654.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>23139.0</td>
      <td>36394.0</td>
      <td>2008-08-16</td>
      <td>home_win</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>229033</th>
      <td>2030171</td>
      <td>4940379</td>
      <td>19</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>36130.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229034</th>
      <td>2030171</td>
      <td>4940624</td>
      <td>44</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>34104.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229035</th>
      <td>2030171</td>
      <td>4940738</td>
      <td>49</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>107930.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229036</th>
      <td>2030171</td>
      <td>4940963</td>
      <td>71</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>210065.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229037</th>
      <td>2030171</td>
      <td>4941072</td>
      <td>83</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>629579.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
      <td>Spain LIGA BBVA</td>
    </tr>
  </tbody>
</table>
<p>229038 rows × 14 columns</p>
</div>



- Combine the league name to the df_match_basic table.


```python
df_match_basic = df_match_basic.merge(org_league.drop("country_id", axis = 1).rename(columns = {"id" : "league_id", "name": "league_name"}), 
                                                      how = "left", on = "league_id")
df_match_basic.drop(["league_id", "country_id"], axis = 1, inplace = True)
```


```python
df_match_basic
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>season</th>
      <th>stage</th>
      <th>match_date</th>
      <th>home_team_api_id</th>
      <th>away_team_api_id</th>
      <th>home_team_goal</th>
      <th>away_team_goal</th>
      <th>match_result</th>
      <th>league_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>492473</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-17</td>
      <td>9987</td>
      <td>9993</td>
      <td>1</td>
      <td>1</td>
      <td>draw</td>
      <td>Belgium Jupiler League</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492474</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16</td>
      <td>10000</td>
      <td>9994</td>
      <td>0</td>
      <td>0</td>
      <td>draw</td>
      <td>Belgium Jupiler League</td>
    </tr>
    <tr>
      <th>2</th>
      <td>492475</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16</td>
      <td>9984</td>
      <td>8635</td>
      <td>0</td>
      <td>3</td>
      <td>away_win</td>
      <td>Belgium Jupiler League</td>
    </tr>
    <tr>
      <th>3</th>
      <td>492476</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-17</td>
      <td>9991</td>
      <td>9998</td>
      <td>5</td>
      <td>0</td>
      <td>home_win</td>
      <td>Belgium Jupiler League</td>
    </tr>
    <tr>
      <th>4</th>
      <td>492477</td>
      <td>2008/2009</td>
      <td>1</td>
      <td>2008-08-16</td>
      <td>7947</td>
      <td>9985</td>
      <td>1</td>
      <td>3</td>
      <td>away_win</td>
      <td>Belgium Jupiler League</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-22</td>
      <td>10190</td>
      <td>10191</td>
      <td>1</td>
      <td>0</td>
      <td>home_win</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-23</td>
      <td>9824</td>
      <td>10199</td>
      <td>1</td>
      <td>2</td>
      <td>away_win</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-23</td>
      <td>9956</td>
      <td>10179</td>
      <td>2</td>
      <td>0</td>
      <td>home_win</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>25977</th>
      <td>1992094</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-22</td>
      <td>7896</td>
      <td>10243</td>
      <td>0</td>
      <td>0</td>
      <td>draw</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>2015/2016</td>
      <td>9</td>
      <td>2015-09-23</td>
      <td>10192</td>
      <td>9931</td>
      <td>4</td>
      <td>3</td>
      <td>home_win</td>
      <td>Switzerland Super League</td>
    </tr>
  </tbody>
</table>
<p>25979 rows × 10 columns</p>
</div>



# 1. Goal


```python
df_match_ingame_shot_goal = df_match_ingame_shot[df_match_ingame_shot.category == "goal"]
```

## 1.1. Goal trend

### Q. Is there any goal trend change over the seasons?


```python
goals_trend = df_match_basic.groupby(["league_name", "season"]).mean()[["home_team_goal", "away_team_goal"]].reset_index()
```


```python
fig, axes = plt.subplots(4, 3, figsize = (20, 15))

for i, league in enumerate(goals_trend.league_name.unique()):
    home = goals_trend.loc[goals_trend.league_name == league, ["league_name", "season", "home_team_goal"]].rename(columns = {"home_team_goal" : "goals"})
    home["home_away"] = "home"

    away = goals_trend.loc[goals_trend.league_name == league, ["league_name", "season", "away_team_goal"]].rename(columns = {"away_team_goal" : "goals"})
    away["home_away"] = "away"
    
    home_m_away = home.copy()
    home_m_away["goals"] = home.goals - away.goals 
    home_m_away["home_away"] = "home goals - away goals"

    home_away = pd.concat([home, away, home_m_away], axis = 0)
    
    sns.lineplot(data = home_away, x = "season", y = "goals", hue = "home_away", marker = "o", ax = axes[i // 3, i % 3])

    axes[i // 3, i % 3].set_xlabel(" ", fontsize = 10)
    axes[i // 3, i % 3].set_ylabel(" ", fontsize = 10)
    axes[i // 3, i % 3].set_title(f"{league} goals trend", fontsize = 15)
    axes[i // 3, i % 3].tick_params(axis='x', labelrotation = 90)

plt.tight_layout()

```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_28_0.png)
    


- Home team scores more goals than away team in all leagues.
- The gap between the average number of home goals and the average number of away goals has remained similar across all seasons from the each league.
  
$\quad \rightarrow$ Since season has no effect in the goal trend, let's check the goal distribution without considering the season.


## 1.2. Goal distribution

- The number of goals has the most direct effect on winning or losing. If a team score more goals and get less, the team can win the game.
- If we can identify the characteristics of a team that scores a lot of goals and a team that scores few goals, we will have an advantage in predicting the match result.

### Q. How many more goals did the winning team score than the losing team?


```python
plt.figure(figsize = (15, 6))
sns.countplot(x = abs(df_match_basic[df_match_basic.match_result != "draw"].home_team_goal - 
                      df_match_basic[df_match_basic.match_result != "draw"].away_team_goal))
plt.title("Difference of number of goals between winning team and losing tema", fontsize = 20)
plt.xlabel("Goal difference", fontsize = 13)
plt.ylabel("Count", fontsize = 13)
```




    Text(0, 0.5, 'Count')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_33_1.png)
    


- Almost half of the matches are won by a difference of only one goal.


### Q. The difference of number of goals between home and away team.


```python
plt.figure(figsize = (15, 6))
sns.countplot(x = df_match_basic.home_team_goal - df_match_basic.away_team_goal)
plt.title("Difference of number of goals between home team and away team", fontsize = 20)
plt.xlabel("Goal difference", fontsize = 13)
plt.ylabel("Count", fontsize = 13)
```




    Text(0, 0.5, 'Count')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_36_1.png)
    


- The side larger than 0 in the distribution is slightly thicker than the smaller side.
- That is, home team usually scores more goals than the away team.

### Q. What is the difference between home and away team win rates?


```python
df_match_basic.match_result.value_counts()
```




    home_win    11917
    away_win     7466
    draw         6596
    Name: match_result, dtype: int64




```python
sns.countplot(x = df_match_basic.match_result,
              order = ["home_win", "draw", "away_win"])
plt.xlabel("Match result", fontsize = 15)
plt.ylabel("Count", fontsize = 15)
```




    Text(0, 0.5, 'Count')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_40_1.png)
    


- Out of a total of 25979 matches
    - About 45% (11917 / 25979) were won by the home team
    - About 25% (6596 / 25979) were draw
    - About 29% (7466 / 25979) were won by the away team   

$\color{magenta} \quad \rightarrow$ <font color="magenta"> This percentage can be used as a baseline accuracy later. </font>

### Q. Is there a difference in the distribution of home and away team goals by league?


```python
df_match_basic.groupby("league_name").home_team_goal.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>league_name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Belgium Jupiler League</th>
      <td>1728.0</td>
      <td>1.609375</td>
      <td>1.293458</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>England Premier League</th>
      <td>3040.0</td>
      <td>1.550987</td>
      <td>1.311615</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>France Ligue 1</th>
      <td>3040.0</td>
      <td>1.402961</td>
      <td>1.170743</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Germany 1. Bundesliga</th>
      <td>2448.0</td>
      <td>1.626634</td>
      <td>1.339529</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Italy Serie A</th>
      <td>3017.0</td>
      <td>1.500829</td>
      <td>1.221797</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>Netherlands Eredivisie</th>
      <td>2448.0</td>
      <td>1.779820</td>
      <td>1.405274</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>3.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>Poland Ekstraklasa</th>
      <td>1920.0</td>
      <td>1.394792</td>
      <td>1.183249</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Portugal Liga ZON Sagres</th>
      <td>2052.0</td>
      <td>1.408382</td>
      <td>1.226192</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>Scotland Premier League</th>
      <td>1824.0</td>
      <td>1.429276</td>
      <td>1.294928</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Spain LIGA BBVA</th>
      <td>3040.0</td>
      <td>1.631250</td>
      <td>1.388339</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>Switzerland Super League</th>
      <td>1422.0</td>
      <td>1.663150</td>
      <td>1.363970</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>7.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
fig, axes = plt.subplots(1, 2, figsize = (20, 7), sharey = True)

sns.boxplot(data = df_match_basic, x = "home_team_goal", y = "league_name", showfliers = False, ax = axes[0])
axes[0].set_xlabel("goals", fontsize = 15)
axes[0].set_ylabel("League", fontsize = 15)
axes[0].set_title("Home team goals distribution", fontsize = 20)

sns.barplot(df_match_basic.groupby("league_name").home_team_goal.describe().reset_index(), x = "mean", y = "league_name")
axes[1].set_xlabel("goals", fontsize = 15)
axes[1].set_ylabel("League", fontsize = 15)
axes[1].set_title("Home team average goals per game", fontsize = 20)
```




    Text(0.5, 1.0, 'Home team average goals per game')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_44_1.png)
    


- Looking at the distribution of the number of home team goals by league over 8 seasons, it can be seen that the Dutch and Swiss leagues have more home team goals than other leagues.
- Average Home team goals per game are around 1.5 across all leagues.
- In the case of the France, Poland, Portugal, and Scotland, home team average goals per game are slightly lower than other leagues.
- In the case of the Netherland, home team average goals per game are slightly higher than other leagues.


```python
df_match_basic.groupby("league_name").away_team_goal.describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>count</th>
      <th>mean</th>
      <th>std</th>
      <th>min</th>
      <th>25%</th>
      <th>50%</th>
      <th>75%</th>
      <th>max</th>
    </tr>
    <tr>
      <th>league_name</th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
      <th></th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>Belgium Jupiler League</th>
      <td>1728.0</td>
      <td>1.192130</td>
      <td>1.125123</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>England Premier League</th>
      <td>3040.0</td>
      <td>1.159539</td>
      <td>1.144629</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>France Ligue 1</th>
      <td>3040.0</td>
      <td>1.040132</td>
      <td>1.059765</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>Germany 1. Bundesliga</th>
      <td>2448.0</td>
      <td>1.274918</td>
      <td>1.200392</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>Italy Serie A</th>
      <td>3017.0</td>
      <td>1.116009</td>
      <td>1.078392</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>Netherlands Eredivisie</th>
      <td>2448.0</td>
      <td>1.301062</td>
      <td>1.240430</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Poland Ekstraklasa</th>
      <td>1920.0</td>
      <td>1.030208</td>
      <td>1.046159</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Portugal Liga ZON Sagres</th>
      <td>2052.0</td>
      <td>1.126218</td>
      <td>1.155469</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Scotland Premier League</th>
      <td>1824.0</td>
      <td>1.204496</td>
      <td>1.151384</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>Spain LIGA BBVA</th>
      <td>3040.0</td>
      <td>1.135855</td>
      <td>1.161079</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>Switzerland Super League</th>
      <td>1422.0</td>
      <td>1.266526</td>
      <td>1.176233</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>7.0</td>
    </tr>
  </tbody>
</table>
</div>




```python
fig, axes = plt.subplots(1, 2, figsize = (20, 7), sharey = True)

sns.boxplot(data = df_match_basic, x = "away_team_goal", y = "league_name", showfliers = False, ax = axes[0])
axes[0].set_xlabel("goals", fontsize = 15)
axes[0].set_ylabel("League", fontsize = 15)
axes[0].set_title("Away team goals distribution", fontsize = 20)

sns.barplot(df_match_basic.groupby("league_name").away_team_goal.describe().reset_index(), x = "mean", y = "league_name")
axes[1].set_xlabel("goals", fontsize = 15)
axes[1].set_ylabel("League", fontsize = 15)
axes[1].set_title("Away team average goals per game", fontsize = 20)

plt.tight_layout()
```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_47_0.png)
    


- The away team's goals distribution over the eight seasons shows a nearly identical distribution across all leagues compared to the home team's goals distributions.
- Away teams score around 1.1 goals per game on average across all leagues.
- In the case of the France and the Poland, away team average goals per game are slightly lower than other leagues.  
- In the case of the Germany, Netherlands, and Switzeland, away team average goals per game are slightly higher than other leagues.

- Average home and away team goals per game vary by league.   

$\color{magenta} \quad \rightarrow$ <font color="magenta"> There is a difference in the average goals of home and away teams in each league, so it is a good idea to try fitting our model differently for each league later. </font>

### Q. What is the difference between home and away team win rates between leagues ?


```python
df_match_result_pivot = df_match_basic.pivot_table(index = "league_name", columns = "match_result", values = "stage", aggfunc = "count")
df_match_result_pivot["sum"] = df_match_result_pivot.sum(axis = 1)

match_result_prop = df_match_result_pivot[["home_win", "away_win", "draw"]].divide(df_match_result_pivot["sum"], axis = 0).multiply(100)

```


```python
ax = match_result_prop.plot.barh(stacked = True, figsize = (10, 8), width = 0.75, edgecolor = 'w')
ax.legend(['Home Team','Away Team','Draw'], bbox_to_anchor = (1.2, 1), loc = 'upper right')
plt.title('Probability of match result by league', fontsize = 20)
plt.xlabel('Proportion',fontsize = 15)
plt.ylabel('Leagues', fontsize = 15)
plt.xticks(fontsize = 12)
plt.yticks(fontsize = 12)

for  i, j in enumerate(match_result_prop.index):
    plt.text(match_result_prop.loc[j, 'home_win']/2, i, str(round(match_result_prop.loc[j, 'home_win'], 2)) + ' %', fontsize = 12)
    plt.text(match_result_prop.loc[j, 'home_win'] + match_result_prop.loc[j,'away_win']/3, i, str(round(match_result_prop.loc[j,'away_win'], 2)) + ' %',fontsize = 12)
    plt.text(match_result_prop.loc[j, 'home_win'] + match_result_prop.loc[j,'away_win']+ match_result_prop.loc[j, 'draw']/2, i, str(round(match_result_prop.loc[j, 'draw'], 2)) + '%', fontsize = 12)

```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_52_0.png)
    


- The overall tendency for the home team to have the highest win rate and the lowest draw rate is similar across leagues.
- However, there are some differences in the detailed ratio.

$\color{magenta} \quad \rightarrow$ <font color="magenta"> This league-specific ratios can later be used as the baseline accuracy for each league when fitting the model for each league. </font>



### Q. How strong is the relationship between home and away average goals and wins ?

- Usually, the home team scores more goals and the away team scores fewer goals, so the home team has a higher win rate.
- It is important for us to predict in which matches the home team will lose, the away team will win, and neither team will win.

- So let's try to figure out the relationship between how many goals are scored at home & away and the winning percentage.


```python
df_team = pd.read_csv("../data/df_team.csv")
```


```python
distinct_team = df_team[["team_api_id", "team_long_name"]].drop_duplicates()
```


```python
goal_match_result_info = distinct_team.merge(df_match_basic.groupby("home_team_api_id").mean().home_team_goal.reset_index().rename(columns = {"home_team_api_id" : "team_api_id",
                                                                                                 "home_team_goal" : "home_avg_goal"}),
                                             how = "left", on = "team_api_id")
```


```python
goal_match_result_info = goal_match_result_info.merge(df_match_basic.groupby("home_team_api_id").mean().away_team_goal.reset_index().rename(columns = {"home_team_api_id" : "team_api_id",
                                                                                                 "away_team_goal" : "home_opponent_avg_goal"}),
                                                      how = "left", on = "team_api_id")
```


```python
goal_match_result_info = goal_match_result_info.merge(df_match_basic.groupby("away_team_api_id").mean().away_team_goal.reset_index().rename(columns = {"away_team_api_id" : "team_api_id",
                                                                                                 "away_team_goal" : "away_avg_goal"}),
                                                      how = "left", on = "team_api_id")
```


```python
goal_match_result_info = goal_match_result_info.merge(df_match_basic.groupby("away_team_api_id").mean().home_team_goal.reset_index().rename(columns = {"away_team_api_id" : "team_api_id",
                                                                                                 "home_team_goal" : "away_opponent_avg_goal"}),
                                                      how = "left", on = "team_api_id")
```


```python
result_from_home = df_match_basic.groupby(["home_team_api_id", "match_result"]).count().match_api_id.reset_index() \
                                 .pivot_table(index = "home_team_api_id", columns = "match_result", values = "match_api_id").reset_index()
```


```python
result_from_home = result_from_home.rename(columns = {"home_team_api_id" : "team_api_id", "home_win": "win_at_home", 
                                                      "draw": "draw_at_home", "away_win": "lose_at_home"})
```


```python
result_from_home["num_home_matches"] = result_from_home.win_at_home + result_from_home.draw_at_home + result_from_home.lose_at_home
result_from_home["win_at_home"] = result_from_home.win_at_home / result_from_home.num_home_matches  
result_from_home["draw_at_home"] = result_from_home.draw_at_home / result_from_home.num_home_matches  
result_from_home["lose_at_home"] = result_from_home.lose_at_home / result_from_home.num_home_matches  

```


```python
result_from_home.drop("num_home_matches", axis = 1, inplace = True)
```


```python
result_from_away = df_match_basic.groupby(["away_team_api_id", "match_result"]).count().match_api_id.reset_index() \
                                 .pivot_table(index = "away_team_api_id", columns = "match_result", values = "match_api_id").reset_index()
```


```python
result_from_away = df_match_basic.groupby(["away_team_api_id", "match_result"]).count().match_api_id.reset_index() \
                                 .pivot_table(index = "away_team_api_id", columns = "match_result", values = "match_api_id").reset_index()
```


```python
result_from_away = result_from_away.rename(columns = {"away_team_api_id" : "team_api_id", "home_win": "lose_at_away", 
                                                      "draw": "draw_at_away", "away_win": "win_at_away"})
```


```python
result_from_away["num_away_matches"] = result_from_away.win_at_away + result_from_away.draw_at_away + result_from_away.lose_at_away
result_from_away["win_at_away"] = result_from_away.win_at_away / result_from_away.num_away_matches  
result_from_away["draw_at_away"] = result_from_away.draw_at_away / result_from_away.num_away_matches  
result_from_away["lose_at_away"] = result_from_away.lose_at_away / result_from_away.num_away_matches  
```


```python
result_from_away.drop("num_away_matches", axis = 1, inplace = True)
```


```python
result_from_away
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th>match_result</th>
      <th>team_api_id</th>
      <th>win_at_away</th>
      <th>draw_at_away</th>
      <th>lose_at_away</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>1601</td>
      <td>0.316667</td>
      <td>0.241667</td>
      <td>0.441667</td>
    </tr>
    <tr>
      <th>1</th>
      <td>1773</td>
      <td>0.133333</td>
      <td>0.333333</td>
      <td>0.533333</td>
    </tr>
    <tr>
      <th>2</th>
      <td>1957</td>
      <td>0.200000</td>
      <td>0.308333</td>
      <td>0.491667</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2033</td>
      <td>0.173333</td>
      <td>0.373333</td>
      <td>0.453333</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2182</td>
      <td>0.416667</td>
      <td>0.275000</td>
      <td>0.308333</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>294</th>
      <td>158085</td>
      <td>0.204082</td>
      <td>0.367347</td>
      <td>0.428571</td>
    </tr>
    <tr>
      <th>295</th>
      <td>177361</td>
      <td>0.200000</td>
      <td>0.333333</td>
      <td>0.466667</td>
    </tr>
    <tr>
      <th>296</th>
      <td>188163</td>
      <td>0.294118</td>
      <td>0.117647</td>
      <td>0.588235</td>
    </tr>
    <tr>
      <th>297</th>
      <td>208931</td>
      <td>0.157895</td>
      <td>0.315789</td>
      <td>0.526316</td>
    </tr>
    <tr>
      <th>298</th>
      <td>274581</td>
      <td>0.166667</td>
      <td>0.233333</td>
      <td>0.600000</td>
    </tr>
  </tbody>
</table>
<p>299 rows × 4 columns</p>
</div>




```python
goal_match_result_info = goal_match_result_info.merge(result_from_home[["team_api_id", "win_at_home", "draw_at_home", "lose_at_home"]], how = "left", on = "team_api_id") \
                                               .merge(result_from_away[["team_api_id", "win_at_away", "draw_at_away", "lose_at_away"]], how = "left", on = "team_api_id")
```


```python
goal_match_result_info
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>team_api_id</th>
      <th>team_long_name</th>
      <th>home_avg_goal</th>
      <th>home_opponent_avg_goal</th>
      <th>away_avg_goal</th>
      <th>away_opponent_avg_goal</th>
      <th>win_at_home</th>
      <th>draw_at_home</th>
      <th>lose_at_home</th>
      <th>win_at_away</th>
      <th>draw_at_away</th>
      <th>lose_at_away</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9930</td>
      <td>FC Aarau</td>
      <td>1.236111</td>
      <td>1.652778</td>
      <td>0.888889</td>
      <td>2.152778</td>
      <td>0.347222</td>
      <td>0.166667</td>
      <td>0.486111</td>
      <td>0.138889</td>
      <td>0.305556</td>
      <td>0.555556</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8485</td>
      <td>Aberdeen</td>
      <td>1.223684</td>
      <td>0.967105</td>
      <td>1.177632</td>
      <td>1.381579</td>
      <td>0.440789</td>
      <td>0.250000</td>
      <td>0.309211</td>
      <td>0.348684</td>
      <td>0.243421</td>
      <td>0.407895</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8576</td>
      <td>AC Ajaccio</td>
      <td>1.122807</td>
      <td>1.350877</td>
      <td>0.912281</td>
      <td>1.877193</td>
      <td>0.280702</td>
      <td>0.333333</td>
      <td>0.385965</td>
      <td>0.105263</td>
      <td>0.368421</td>
      <td>0.526316</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8564</td>
      <td>Milan</td>
      <td>1.794702</td>
      <td>0.847682</td>
      <td>1.480263</td>
      <td>1.210526</td>
      <td>0.609272</td>
      <td>0.225166</td>
      <td>0.165563</td>
      <td>0.407895</td>
      <td>0.296053</td>
      <td>0.296053</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10215</td>
      <td>Académica de Coimbra</td>
      <td>1.096774</td>
      <td>1.258065</td>
      <td>0.838710</td>
      <td>1.532258</td>
      <td>0.282258</td>
      <td>0.387097</td>
      <td>0.330645</td>
      <td>0.169355</td>
      <td>0.274194</td>
      <td>0.556452</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>283</th>
      <td>10192</td>
      <td>BSC Young Boys</td>
      <td>2.230769</td>
      <td>1.160839</td>
      <td>1.468531</td>
      <td>1.447552</td>
      <td>0.594406</td>
      <td>0.237762</td>
      <td>0.167832</td>
      <td>0.398601</td>
      <td>0.244755</td>
      <td>0.356643</td>
    </tr>
    <tr>
      <th>284</th>
      <td>8021</td>
      <td>Zagłębie Lubin</td>
      <td>1.288889</td>
      <td>1.200000</td>
      <td>1.011111</td>
      <td>1.377778</td>
      <td>0.388889</td>
      <td>0.300000</td>
      <td>0.311111</td>
      <td>0.266667</td>
      <td>0.266667</td>
      <td>0.466667</td>
    </tr>
    <tr>
      <th>285</th>
      <td>8394</td>
      <td>Real Zaragoza</td>
      <td>1.250000</td>
      <td>1.328947</td>
      <td>0.842105</td>
      <td>1.828947</td>
      <td>0.381579</td>
      <td>0.223684</td>
      <td>0.394737</td>
      <td>0.184211</td>
      <td>0.223684</td>
      <td>0.592105</td>
    </tr>
    <tr>
      <th>286</th>
      <td>8027</td>
      <td>Zawisza Bydgoszcz</td>
      <td>1.433333</td>
      <td>1.266667</td>
      <td>1.066667</td>
      <td>1.700000</td>
      <td>0.433333</td>
      <td>0.166667</td>
      <td>0.400000</td>
      <td>0.200000</td>
      <td>0.300000</td>
      <td>0.500000</td>
    </tr>
    <tr>
      <th>287</th>
      <td>10000</td>
      <td>SV Zulte-Waregem</td>
      <td>1.660377</td>
      <td>1.273585</td>
      <td>1.226415</td>
      <td>1.367925</td>
      <td>0.424528</td>
      <td>0.301887</td>
      <td>0.273585</td>
      <td>0.311321</td>
      <td>0.283019</td>
      <td>0.405660</td>
    </tr>
  </tbody>
</table>
<p>288 rows × 12 columns</p>
</div>




```python
target_team_api = goal_match_result_info.sort_values("win_at_home", ascending = False).iloc[:25].team_api_id
goal_match_result_info.loc[goal_match_result_info.team_api_id.isin(target_team_api), "home_win_class"] = "home_win_best_10%_teams"

target_team_api = goal_match_result_info.sort_values("win_at_home").iloc[:25].team_api_id
goal_match_result_info.loc[goal_match_result_info.team_api_id.isin(target_team_api), "home_win_class"] = "home_win_worst_10%_teams"

target_team_api = goal_match_result_info.sort_values("win_at_away", ascending = False).iloc[:25].team_api_id
goal_match_result_info.loc[goal_match_result_info.team_api_id.isin(target_team_api), "away_win_class"] = "away_win_best_10%_teams"

target_team_api = goal_match_result_info.sort_values("win_at_away").iloc[:25].team_api_id
goal_match_result_info.loc[goal_match_result_info.team_api_id.isin(target_team_api), "away_win_class"] = "away_win_worst_10%_teams"

```


```python
goal_match_result_info
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>team_api_id</th>
      <th>team_long_name</th>
      <th>home_avg_goal</th>
      <th>home_opponent_avg_goal</th>
      <th>away_avg_goal</th>
      <th>away_opponent_avg_goal</th>
      <th>win_at_home</th>
      <th>draw_at_home</th>
      <th>lose_at_home</th>
      <th>win_at_away</th>
      <th>draw_at_away</th>
      <th>lose_at_away</th>
      <th>home_win_class</th>
      <th>away_win_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9930</td>
      <td>FC Aarau</td>
      <td>1.236111</td>
      <td>1.652778</td>
      <td>0.888889</td>
      <td>2.152778</td>
      <td>0.347222</td>
      <td>0.166667</td>
      <td>0.486111</td>
      <td>0.138889</td>
      <td>0.305556</td>
      <td>0.555556</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8485</td>
      <td>Aberdeen</td>
      <td>1.223684</td>
      <td>0.967105</td>
      <td>1.177632</td>
      <td>1.381579</td>
      <td>0.440789</td>
      <td>0.250000</td>
      <td>0.309211</td>
      <td>0.348684</td>
      <td>0.243421</td>
      <td>0.407895</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8576</td>
      <td>AC Ajaccio</td>
      <td>1.122807</td>
      <td>1.350877</td>
      <td>0.912281</td>
      <td>1.877193</td>
      <td>0.280702</td>
      <td>0.333333</td>
      <td>0.385965</td>
      <td>0.105263</td>
      <td>0.368421</td>
      <td>0.526316</td>
      <td>NaN</td>
      <td>away_win_worst_10%_teams</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8564</td>
      <td>Milan</td>
      <td>1.794702</td>
      <td>0.847682</td>
      <td>1.480263</td>
      <td>1.210526</td>
      <td>0.609272</td>
      <td>0.225166</td>
      <td>0.165563</td>
      <td>0.407895</td>
      <td>0.296053</td>
      <td>0.296053</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10215</td>
      <td>Académica de Coimbra</td>
      <td>1.096774</td>
      <td>1.258065</td>
      <td>0.838710</td>
      <td>1.532258</td>
      <td>0.282258</td>
      <td>0.387097</td>
      <td>0.330645</td>
      <td>0.169355</td>
      <td>0.274194</td>
      <td>0.556452</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>283</th>
      <td>10192</td>
      <td>BSC Young Boys</td>
      <td>2.230769</td>
      <td>1.160839</td>
      <td>1.468531</td>
      <td>1.447552</td>
      <td>0.594406</td>
      <td>0.237762</td>
      <td>0.167832</td>
      <td>0.398601</td>
      <td>0.244755</td>
      <td>0.356643</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>284</th>
      <td>8021</td>
      <td>Zagłębie Lubin</td>
      <td>1.288889</td>
      <td>1.200000</td>
      <td>1.011111</td>
      <td>1.377778</td>
      <td>0.388889</td>
      <td>0.300000</td>
      <td>0.311111</td>
      <td>0.266667</td>
      <td>0.266667</td>
      <td>0.466667</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>285</th>
      <td>8394</td>
      <td>Real Zaragoza</td>
      <td>1.250000</td>
      <td>1.328947</td>
      <td>0.842105</td>
      <td>1.828947</td>
      <td>0.381579</td>
      <td>0.223684</td>
      <td>0.394737</td>
      <td>0.184211</td>
      <td>0.223684</td>
      <td>0.592105</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>286</th>
      <td>8027</td>
      <td>Zawisza Bydgoszcz</td>
      <td>1.433333</td>
      <td>1.266667</td>
      <td>1.066667</td>
      <td>1.700000</td>
      <td>0.433333</td>
      <td>0.166667</td>
      <td>0.400000</td>
      <td>0.200000</td>
      <td>0.300000</td>
      <td>0.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>287</th>
      <td>10000</td>
      <td>SV Zulte-Waregem</td>
      <td>1.660377</td>
      <td>1.273585</td>
      <td>1.226415</td>
      <td>1.367925</td>
      <td>0.424528</td>
      <td>0.301887</td>
      <td>0.273585</td>
      <td>0.311321</td>
      <td>0.283019</td>
      <td>0.405660</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>288 rows × 14 columns</p>
</div>




```python
fig, axes = plt.subplots(2, 2, figsize = (12, 10))

sns.histplot(goal_match_result_info, x = "home_avg_goal", ax = axes[0, 0])
sns.histplot(goal_match_result_info, x = "home_opponent_avg_goal", ax = axes[0, 1])

axes[0, 0].set_xlabel("Average goal at home", fontsize = 15)
axes[0, 0].set_ylabel("Count", fontsize = 15)

axes[0, 1].set_ylabel("")
axes[0, 1].set_xlabel("Opponent's average goal at home", fontsize = 15)
axes[0, 1].yaxis.set_tick_params(labelleft = False)

sns.histplot(goal_match_result_info, x = "away_avg_goal", ax = axes[1, 0])
sns.histplot(goal_match_result_info, x = "away_opponent_avg_goal", ax = axes[1, 1])

axes[1, 0].set_xlabel("Average goal at away", fontsize = 15)
axes[1, 0].set_ylabel("Count", fontsize = 15)

axes[1, 1].set_ylabel("")
axes[1, 1].set_xlabel("Opponent's average goal at away", fontsize = 15)
axes[1, 1].yaxis.set_tick_params(labelleft = False)

plt.suptitle("Histogram of 299 soccer teams", fontsize = 20)

```




    Text(0.5, 0.98, 'Histogram of 299 soccer teams')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_77_1.png)
    


- It can be seen that the ability to score goals or block goals in home/away matches is very different for each team.
- These differences will affect home and away win rates for each team.

- Let's compare the best and worst 10% teams with the win rate at home.


```python
fig, axes = plt.subplots(1, 2, figsize = (12, 5))

sns.boxplot(goal_match_result_info, x = "home_avg_goal", y = "home_win_class", ax = axes[0])
sns.boxplot(goal_match_result_info, x = "home_opponent_avg_goal", y = "home_win_class", ax = axes[1])

axes[0].set_ylabel("Home win class", fontsize = 15)
axes[0].set_xlabel("Average goal at home", fontsize = 15)

axes[1].set_ylabel("")
axes[1].set_xlabel("Opponent's average goal at home", fontsize = 15)
axes[1].yaxis.set_tick_params(labelleft = False)

plt.tight_layout()
```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_80_0.png)
    


- Teams in the best 10% of home win percentage score an average of 1.2 more goals at home than teams in the worst 10%.
- For the best 10% teams with high win percentage at home, the average number of goals scored by the opposing team is around 0.8, very low compared to 1.6 from the worst 10% teams.  



```python
goal_match_result_info
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>team_api_id</th>
      <th>team_long_name</th>
      <th>home_avg_goal</th>
      <th>home_opponent_avg_goal</th>
      <th>away_avg_goal</th>
      <th>away_opponent_avg_goal</th>
      <th>win_at_home</th>
      <th>draw_at_home</th>
      <th>lose_at_home</th>
      <th>win_at_away</th>
      <th>draw_at_away</th>
      <th>lose_at_away</th>
      <th>home_win_class</th>
      <th>away_win_class</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>9930</td>
      <td>FC Aarau</td>
      <td>1.236111</td>
      <td>1.652778</td>
      <td>0.888889</td>
      <td>2.152778</td>
      <td>0.347222</td>
      <td>0.166667</td>
      <td>0.486111</td>
      <td>0.138889</td>
      <td>0.305556</td>
      <td>0.555556</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>8485</td>
      <td>Aberdeen</td>
      <td>1.223684</td>
      <td>0.967105</td>
      <td>1.177632</td>
      <td>1.381579</td>
      <td>0.440789</td>
      <td>0.250000</td>
      <td>0.309211</td>
      <td>0.348684</td>
      <td>0.243421</td>
      <td>0.407895</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>8576</td>
      <td>AC Ajaccio</td>
      <td>1.122807</td>
      <td>1.350877</td>
      <td>0.912281</td>
      <td>1.877193</td>
      <td>0.280702</td>
      <td>0.333333</td>
      <td>0.385965</td>
      <td>0.105263</td>
      <td>0.368421</td>
      <td>0.526316</td>
      <td>NaN</td>
      <td>away_win_worst_10%_teams</td>
    </tr>
    <tr>
      <th>3</th>
      <td>8564</td>
      <td>Milan</td>
      <td>1.794702</td>
      <td>0.847682</td>
      <td>1.480263</td>
      <td>1.210526</td>
      <td>0.609272</td>
      <td>0.225166</td>
      <td>0.165563</td>
      <td>0.407895</td>
      <td>0.296053</td>
      <td>0.296053</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>10215</td>
      <td>Académica de Coimbra</td>
      <td>1.096774</td>
      <td>1.258065</td>
      <td>0.838710</td>
      <td>1.532258</td>
      <td>0.282258</td>
      <td>0.387097</td>
      <td>0.330645</td>
      <td>0.169355</td>
      <td>0.274194</td>
      <td>0.556452</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>283</th>
      <td>10192</td>
      <td>BSC Young Boys</td>
      <td>2.230769</td>
      <td>1.160839</td>
      <td>1.468531</td>
      <td>1.447552</td>
      <td>0.594406</td>
      <td>0.237762</td>
      <td>0.167832</td>
      <td>0.398601</td>
      <td>0.244755</td>
      <td>0.356643</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>284</th>
      <td>8021</td>
      <td>Zagłębie Lubin</td>
      <td>1.288889</td>
      <td>1.200000</td>
      <td>1.011111</td>
      <td>1.377778</td>
      <td>0.388889</td>
      <td>0.300000</td>
      <td>0.311111</td>
      <td>0.266667</td>
      <td>0.266667</td>
      <td>0.466667</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>285</th>
      <td>8394</td>
      <td>Real Zaragoza</td>
      <td>1.250000</td>
      <td>1.328947</td>
      <td>0.842105</td>
      <td>1.828947</td>
      <td>0.381579</td>
      <td>0.223684</td>
      <td>0.394737</td>
      <td>0.184211</td>
      <td>0.223684</td>
      <td>0.592105</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>286</th>
      <td>8027</td>
      <td>Zawisza Bydgoszcz</td>
      <td>1.433333</td>
      <td>1.266667</td>
      <td>1.066667</td>
      <td>1.700000</td>
      <td>0.433333</td>
      <td>0.166667</td>
      <td>0.400000</td>
      <td>0.200000</td>
      <td>0.300000</td>
      <td>0.500000</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>287</th>
      <td>10000</td>
      <td>SV Zulte-Waregem</td>
      <td>1.660377</td>
      <td>1.273585</td>
      <td>1.226415</td>
      <td>1.367925</td>
      <td>0.424528</td>
      <td>0.301887</td>
      <td>0.273585</td>
      <td>0.311321</td>
      <td>0.283019</td>
      <td>0.405660</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
  </tbody>
</table>
<p>288 rows × 14 columns</p>
</div>




```python
fig, axes = plt.subplots(1, 2, figsize = (12, 5))

sns.boxplot(goal_match_result_info, x = "away_avg_goal", y = "away_win_class", ax = axes[0])
sns.boxplot(goal_match_result_info, x = "away_opponent_avg_goal", y = "away_win_class", ax = axes[1])

axes[0].set_ylabel("Away win class", fontsize = 15)
axes[0].set_xlabel("Average goal at away", fontsize = 15)

axes[1].set_ylabel("")
axes[1].set_xlabel("Opponent's average goal at away", fontsize = 15)
axes[1].yaxis.set_tick_params(labelleft = False)
```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_83_0.png)
    


- Teams in the best 10% of away win percentage score an average of 1.2 more goals at away than teams in the worst 10%.
- For the best 10% teams with high win percentage at away, the average number of goals scored by the opposing team is around 1, very low compared to 2.2 from the worst 10% teams.


$\color{magenta} \quad \rightarrow$ <font color="magenta"> So, let's create a variable for each team that indicates how well they score goals when home, how well they block goals when home, how well they score goals when away, and how well they block goals when away:       
       
$\quad \quad$ - Each team's last 1 / 3 / 5 / 10 / 20 / 30 / 60 / 90 matches     
   
$\quad \quad \quad \quad$ - average goal at home                             
    
$\\ \quad \quad \quad \quad$ - average opponent's goal at home 
   
$\\ \quad \quad \quad \quad$ - average goal at away 
   
$\\ \quad \quad \quad \quad$ - average opponent's goal at away 
  
</font>


```python
home_goal_info = df_match_basic[["home_team_api_id", "match_date", "season", "home_team_goal", "away_team_goal"]].sort_values(["home_team_api_id", "match_date"])
```


```python
for i in [1, 3, 5, 10, 20, 30, 60, 90]:
    home_goal_info[f"home_team_avg_goal_at_home_last_{i}_matches"] = home_goal_info.groupby('home_team_api_id')['home_team_goal'].shift(1).rolling(i).mean()
    home_goal_info[f"home_team_avg_oppnt_goal_at_home_last_{i}_matches"] = home_goal_info.groupby('home_team_api_id')['away_team_goal'].shift(1).rolling(i).mean()
```


```python
away_goal_info = df_match_basic[["away_team_api_id", "match_date", "season", "home_team_goal", "away_team_goal"]].sort_values(["away_team_api_id", "match_date"])
```


```python
for i in [1, 3, 5, 10, 20, 30, 60, 90]:
    away_goal_info[f"away_team_avg_goal_at_away_last_{i}_matches"] = away_goal_info.groupby('away_team_api_id')['away_team_goal'].shift(1).rolling(i).mean()
    away_goal_info[f"away_team_avg_oppnt_goal_at_away_last_{i}_matches"] = away_goal_info.groupby('away_team_api_id')['home_team_goal'].shift(1).rolling(i).mean()
```


```python
df_team_win_goal_rolling_features = df_match_basic[["match_api_id", "match_date", "home_team_api_id", "away_team_api_id"]]
```


```python
df_team_win_goal_rolling_features = df_team_win_goal_rolling_features.merge(home_goal_info.drop(["season", "home_team_goal", "away_team_goal"], axis = 1), how = "left", on = ["match_date", "home_team_api_id"]) \
                                                                     .merge(away_goal_info.drop(["season", "home_team_goal", "away_team_goal"], axis = 1), how = "left", on = ["match_date", "away_team_api_id"]) 
                                                                    
df_team_win_goal_rolling_features                                                         
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>match_date</th>
      <th>home_team_api_id</th>
      <th>away_team_api_id</th>
      <th>home_team_avg_goal_at_home_last_1_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_1_matches</th>
      <th>home_team_avg_goal_at_home_last_3_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_3_matches</th>
      <th>home_team_avg_goal_at_home_last_5_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_5_matches</th>
      <th>home_team_avg_goal_at_home_last_10_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_10_matches</th>
      <th>home_team_avg_goal_at_home_last_20_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_20_matches</th>
      <th>home_team_avg_goal_at_home_last_30_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_30_matches</th>
      <th>home_team_avg_goal_at_home_last_60_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_60_matches</th>
      <th>home_team_avg_goal_at_home_last_90_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_90_matches</th>
      <th>away_team_avg_goal_at_away_last_1_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_1_matches</th>
      <th>away_team_avg_goal_at_away_last_3_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_3_matches</th>
      <th>away_team_avg_goal_at_away_last_5_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_5_matches</th>
      <th>away_team_avg_goal_at_away_last_10_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_10_matches</th>
      <th>away_team_avg_goal_at_away_last_20_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_20_matches</th>
      <th>away_team_avg_goal_at_away_last_30_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_30_matches</th>
      <th>away_team_avg_goal_at_away_last_60_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_60_matches</th>
      <th>away_team_avg_goal_at_away_last_90_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_90_matches</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>492473</td>
      <td>2008-08-17</td>
      <td>9987</td>
      <td>9993</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492474</td>
      <td>2008-08-16</td>
      <td>10000</td>
      <td>9994</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>492475</td>
      <td>2008-08-16</td>
      <td>9984</td>
      <td>8635</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>492476</td>
      <td>2008-08-17</td>
      <td>9991</td>
      <td>9998</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>492477</td>
      <td>2008-08-16</td>
      <td>7947</td>
      <td>9985</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>2015-09-22</td>
      <td>10190</td>
      <td>10191</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.333333</td>
      <td>1.666667</td>
      <td>1.6</td>
      <td>1.2</td>
      <td>1.6</td>
      <td>1.3</td>
      <td>1.55</td>
      <td>1.30</td>
      <td>1.500000</td>
      <td>1.333333</td>
      <td>1.533333</td>
      <td>1.133333</td>
      <td>1.400000</td>
      <td>1.311111</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.666667</td>
      <td>3.000000</td>
      <td>2.0</td>
      <td>2.8</td>
      <td>1.1</td>
      <td>2.3</td>
      <td>0.85</td>
      <td>1.60</td>
      <td>1.166667</td>
      <td>1.600000</td>
      <td>1.033333</td>
      <td>1.500000</td>
      <td>0.977778</td>
      <td>1.377778</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>2015-09-23</td>
      <td>9824</td>
      <td>10199</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.666667</td>
      <td>1.333333</td>
      <td>1.4</td>
      <td>1.4</td>
      <td>1.1</td>
      <td>1.6</td>
      <td>0.95</td>
      <td>1.55</td>
      <td>1.133333</td>
      <td>1.866667</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.333333</td>
      <td>0.666667</td>
      <td>1.8</td>
      <td>0.6</td>
      <td>2.0</td>
      <td>0.7</td>
      <td>1.80</td>
      <td>1.25</td>
      <td>1.566667</td>
      <td>1.533333</td>
      <td>1.450000</td>
      <td>1.633333</td>
      <td>1.377778</td>
      <td>1.588889</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>2015-09-23</td>
      <td>9956</td>
      <td>10179</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.666667</td>
      <td>2.000000</td>
      <td>2.6</td>
      <td>1.2</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.70</td>
      <td>1.25</td>
      <td>1.900000</td>
      <td>1.333333</td>
      <td>1.616667</td>
      <td>1.133333</td>
      <td>1.488889</td>
      <td>1.222222</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>1.333333</td>
      <td>1.0</td>
      <td>1.8</td>
      <td>0.9</td>
      <td>1.1</td>
      <td>0.90</td>
      <td>1.35</td>
      <td>0.800000</td>
      <td>1.366667</td>
      <td>0.816667</td>
      <td>1.550000</td>
      <td>0.966667</td>
      <td>1.355556</td>
    </tr>
    <tr>
      <th>25977</th>
      <td>1992094</td>
      <td>2015-09-22</td>
      <td>7896</td>
      <td>10243</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.666667</td>
      <td>1.333333</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.333333</td>
      <td>2.000000</td>
      <td>1.4</td>
      <td>1.6</td>
      <td>1.2</td>
      <td>1.9</td>
      <td>1.60</td>
      <td>1.45</td>
      <td>1.566667</td>
      <td>1.500000</td>
      <td>1.583333</td>
      <td>1.500000</td>
      <td>1.566667</td>
      <td>1.455556</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>2015-09-23</td>
      <td>10192</td>
      <td>9931</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2.333333</td>
      <td>0.666667</td>
      <td>2.0</td>
      <td>0.8</td>
      <td>2.2</td>
      <td>0.8</td>
      <td>2.40</td>
      <td>1.10</td>
      <td>2.166667</td>
      <td>1.266667</td>
      <td>2.016667</td>
      <td>1.166667</td>
      <td>2.011111</td>
      <td>1.222222</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.000000</td>
      <td>1.333333</td>
      <td>2.4</td>
      <td>1.6</td>
      <td>2.4</td>
      <td>1.3</td>
      <td>2.40</td>
      <td>1.45</td>
      <td>2.200000</td>
      <td>1.266667</td>
      <td>1.883333</td>
      <td>1.166667</td>
      <td>1.877778</td>
      <td>1.188889</td>
    </tr>
  </tbody>
</table>
<p>25979 rows × 36 columns</p>
</div>



- <font color="magenta"> Also let's use the each team's win or lose percentage at home and away for recent 1 / 3 / 5 / 10 / 20 / 30 / 60 / 90 matches. </font>


```python
home_win_info = df_match_basic[["home_team_api_id", "match_date", "match_result"]].sort_values(["home_team_api_id", "match_date"])
```


```python
home_win_info.loc[home_win_info.match_result == "home_win", "is_win"] = 1 
home_win_info.loc[home_win_info.match_result != "home_win", "is_win"] = 0 

home_win_info.loc[home_win_info.match_result == "away_win", "is_lose"] = 1
home_win_info.loc[home_win_info.match_result != "away_win", "is_lose"] = 0
```


```python
for i in [1, 3, 5, 10, 20, 30, 60, 90]:
    home_win_info[f"home_team_home_win_percentage_last_{i}_matches"] = home_win_info.groupby('home_team_api_id')['is_win'].shift(1).rolling(i).mean()
    home_win_info[f"home_team_home_lose_percentage_last_{i}_matches"] = home_win_info.groupby('home_team_api_id')['is_lose'].shift(1).rolling(i).mean()
```


```python
away_win_info = df_match_basic[["away_team_api_id", "match_date", "match_result"]].sort_values(["away_team_api_id", "match_date"])
```


```python
away_win_info.loc[away_win_info.match_result == "away_win", "is_win"] = 1 
away_win_info.loc[away_win_info.match_result != "away_win", "is_win"] = 0 

away_win_info.loc[away_win_info.match_result == "home_win", "is_lose"] = 1
away_win_info.loc[away_win_info.match_result != "home_win", "is_lose"] = 0
```


```python
for i in [1, 3, 5, 10, 20, 30, 60, 90]:
    away_win_info[f"away_team_away_win_percentage_last_{i}_matches"] = away_win_info.groupby('away_team_api_id')['is_win'].shift(1).rolling(i).mean()
    away_win_info[f"away_team_away_lose_percentage_last_{i}_matches"] = away_win_info.groupby('away_team_api_id')['is_lose'].shift(1).rolling(i).mean()
```


```python
df_team_win_goal_rolling_features = df_team_win_goal_rolling_features.merge(home_win_info.drop(["match_result", "is_win", "is_lose"], axis = 1), how = "left", on = ["match_date", "home_team_api_id"]) \
                                                                     .merge(away_win_info.drop(["match_result", "is_win", "is_lose"], axis = 1), how = "left", on = ["match_date", "away_team_api_id"]) \
                                                                     .drop(["match_date", "home_team_api_id", "away_team_api_id"], axis = 1)
df_team_win_goal_rolling_features                                                         
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_team_avg_goal_at_home_last_1_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_1_matches</th>
      <th>home_team_avg_goal_at_home_last_3_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_3_matches</th>
      <th>home_team_avg_goal_at_home_last_5_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_5_matches</th>
      <th>home_team_avg_goal_at_home_last_10_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_10_matches</th>
      <th>home_team_avg_goal_at_home_last_20_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_20_matches</th>
      <th>home_team_avg_goal_at_home_last_30_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_30_matches</th>
      <th>home_team_avg_goal_at_home_last_60_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_60_matches</th>
      <th>home_team_avg_goal_at_home_last_90_matches</th>
      <th>home_team_avg_oppnt_goal_at_home_last_90_matches</th>
      <th>away_team_avg_goal_at_away_last_1_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_1_matches</th>
      <th>away_team_avg_goal_at_away_last_3_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_3_matches</th>
      <th>away_team_avg_goal_at_away_last_5_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_5_matches</th>
      <th>away_team_avg_goal_at_away_last_10_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_10_matches</th>
      <th>away_team_avg_goal_at_away_last_20_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_20_matches</th>
      <th>away_team_avg_goal_at_away_last_30_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_30_matches</th>
      <th>away_team_avg_goal_at_away_last_60_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_60_matches</th>
      <th>away_team_avg_goal_at_away_last_90_matches</th>
      <th>away_team_avg_oppnt_goal_at_away_last_90_matches</th>
      <th>home_team_home_win_percentage_last_1_matches</th>
      <th>home_team_home_lose_percentage_last_1_matches</th>
      <th>home_team_home_win_percentage_last_3_matches</th>
      <th>home_team_home_lose_percentage_last_3_matches</th>
      <th>home_team_home_win_percentage_last_5_matches</th>
      <th>home_team_home_lose_percentage_last_5_matches</th>
      <th>home_team_home_win_percentage_last_10_matches</th>
      <th>home_team_home_lose_percentage_last_10_matches</th>
      <th>home_team_home_win_percentage_last_20_matches</th>
      <th>home_team_home_lose_percentage_last_20_matches</th>
      <th>home_team_home_win_percentage_last_30_matches</th>
      <th>home_team_home_lose_percentage_last_30_matches</th>
      <th>home_team_home_win_percentage_last_60_matches</th>
      <th>home_team_home_lose_percentage_last_60_matches</th>
      <th>home_team_home_win_percentage_last_90_matches</th>
      <th>home_team_home_lose_percentage_last_90_matches</th>
      <th>away_team_away_win_percentage_last_1_matches</th>
      <th>away_team_away_lose_percentage_last_1_matches</th>
      <th>away_team_away_win_percentage_last_3_matches</th>
      <th>away_team_away_lose_percentage_last_3_matches</th>
      <th>away_team_away_win_percentage_last_5_matches</th>
      <th>away_team_away_lose_percentage_last_5_matches</th>
      <th>away_team_away_win_percentage_last_10_matches</th>
      <th>away_team_away_lose_percentage_last_10_matches</th>
      <th>away_team_away_win_percentage_last_20_matches</th>
      <th>away_team_away_lose_percentage_last_20_matches</th>
      <th>away_team_away_win_percentage_last_30_matches</th>
      <th>away_team_away_lose_percentage_last_30_matches</th>
      <th>away_team_away_win_percentage_last_60_matches</th>
      <th>away_team_away_lose_percentage_last_60_matches</th>
      <th>away_team_away_win_percentage_last_90_matches</th>
      <th>away_team_away_lose_percentage_last_90_matches</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>492473</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492474</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>492475</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>492476</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>492477</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>0.0</td>
      <td>2.0</td>
      <td>0.333333</td>
      <td>1.666667</td>
      <td>1.6</td>
      <td>1.2</td>
      <td>1.6</td>
      <td>1.3</td>
      <td>1.55</td>
      <td>1.30</td>
      <td>1.500000</td>
      <td>1.333333</td>
      <td>1.533333</td>
      <td>1.133333</td>
      <td>1.400000</td>
      <td>1.311111</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>1.666667</td>
      <td>3.000000</td>
      <td>2.0</td>
      <td>2.8</td>
      <td>1.1</td>
      <td>2.3</td>
      <td>0.85</td>
      <td>1.60</td>
      <td>1.166667</td>
      <td>1.600000</td>
      <td>1.033333</td>
      <td>1.500000</td>
      <td>0.977778</td>
      <td>1.377778</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.000000</td>
      <td>0.666667</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>0.40</td>
      <td>0.30</td>
      <td>0.4</td>
      <td>0.266667</td>
      <td>0.450000</td>
      <td>0.233333</td>
      <td>0.388889</td>
      <td>0.333333</td>
      <td>0.0</td>
      <td>0.0</td>
      <td>0.000000</td>
      <td>0.666667</td>
      <td>0.2</td>
      <td>0.6</td>
      <td>0.1</td>
      <td>0.6</td>
      <td>0.15</td>
      <td>0.45</td>
      <td>0.233333</td>
      <td>0.466667</td>
      <td>0.233333</td>
      <td>0.516667</td>
      <td>0.255556</td>
      <td>0.477778</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.666667</td>
      <td>1.333333</td>
      <td>1.4</td>
      <td>1.4</td>
      <td>1.1</td>
      <td>1.6</td>
      <td>0.95</td>
      <td>1.55</td>
      <td>1.133333</td>
      <td>1.866667</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>2.333333</td>
      <td>0.666667</td>
      <td>1.8</td>
      <td>0.6</td>
      <td>2.0</td>
      <td>0.7</td>
      <td>1.80</td>
      <td>1.25</td>
      <td>1.566667</td>
      <td>1.533333</td>
      <td>1.450000</td>
      <td>1.633333</td>
      <td>1.377778</td>
      <td>1.588889</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.333333</td>
      <td>0.000000</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>0.2</td>
      <td>0.5</td>
      <td>0.20</td>
      <td>0.45</td>
      <td>0.2</td>
      <td>0.500000</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.8</td>
      <td>0.0</td>
      <td>0.8</td>
      <td>0.1</td>
      <td>0.50</td>
      <td>0.30</td>
      <td>0.400000</td>
      <td>0.433333</td>
      <td>0.350000</td>
      <td>0.450000</td>
      <td>0.311111</td>
      <td>0.455556</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>3.0</td>
      <td>2.0</td>
      <td>3.666667</td>
      <td>2.000000</td>
      <td>2.6</td>
      <td>1.2</td>
      <td>2.0</td>
      <td>1.0</td>
      <td>1.70</td>
      <td>1.25</td>
      <td>1.900000</td>
      <td>1.333333</td>
      <td>1.616667</td>
      <td>1.133333</td>
      <td>1.488889</td>
      <td>1.222222</td>
      <td>2.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>1.333333</td>
      <td>1.0</td>
      <td>1.8</td>
      <td>0.9</td>
      <td>1.1</td>
      <td>0.90</td>
      <td>1.35</td>
      <td>0.800000</td>
      <td>1.366667</td>
      <td>0.816667</td>
      <td>1.550000</td>
      <td>0.966667</td>
      <td>1.355556</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.666667</td>
      <td>0.333333</td>
      <td>0.6</td>
      <td>0.2</td>
      <td>0.5</td>
      <td>0.1</td>
      <td>0.45</td>
      <td>0.30</td>
      <td>0.5</td>
      <td>0.300000</td>
      <td>0.500000</td>
      <td>0.283333</td>
      <td>0.466667</td>
      <td>0.333333</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.333333</td>
      <td>0.333333</td>
      <td>0.2</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>0.3</td>
      <td>0.25</td>
      <td>0.45</td>
      <td>0.233333</td>
      <td>0.500000</td>
      <td>0.233333</td>
      <td>0.550000</td>
      <td>0.266667</td>
      <td>0.466667</td>
    </tr>
    <tr>
      <th>25977</th>
      <td>1992094</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.666667</td>
      <td>1.333333</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>1.333333</td>
      <td>2.000000</td>
      <td>1.4</td>
      <td>1.6</td>
      <td>1.2</td>
      <td>1.9</td>
      <td>1.60</td>
      <td>1.45</td>
      <td>1.566667</td>
      <td>1.500000</td>
      <td>1.583333</td>
      <td>1.500000</td>
      <td>1.566667</td>
      <td>1.455556</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.333333</td>
      <td>0.666667</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>0.0</td>
      <td>1.0</td>
      <td>0.333333</td>
      <td>0.666667</td>
      <td>0.4</td>
      <td>0.4</td>
      <td>0.3</td>
      <td>0.4</td>
      <td>0.45</td>
      <td>0.30</td>
      <td>0.466667</td>
      <td>0.366667</td>
      <td>0.450000</td>
      <td>0.350000</td>
      <td>0.455556</td>
      <td>0.355556</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>4.0</td>
      <td>0.0</td>
      <td>2.333333</td>
      <td>0.666667</td>
      <td>2.0</td>
      <td>0.8</td>
      <td>2.2</td>
      <td>0.8</td>
      <td>2.40</td>
      <td>1.10</td>
      <td>2.166667</td>
      <td>1.266667</td>
      <td>2.016667</td>
      <td>1.166667</td>
      <td>2.011111</td>
      <td>1.222222</td>
      <td>3.0</td>
      <td>1.0</td>
      <td>3.000000</td>
      <td>1.333333</td>
      <td>2.4</td>
      <td>1.6</td>
      <td>2.4</td>
      <td>1.3</td>
      <td>2.40</td>
      <td>1.45</td>
      <td>2.200000</td>
      <td>1.266667</td>
      <td>1.883333</td>
      <td>1.166667</td>
      <td>1.877778</td>
      <td>1.188889</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>0.666667</td>
      <td>0.333333</td>
      <td>0.6</td>
      <td>0.2</td>
      <td>0.6</td>
      <td>0.2</td>
      <td>0.70</td>
      <td>0.20</td>
      <td>0.6</td>
      <td>0.200000</td>
      <td>0.566667</td>
      <td>0.233333</td>
      <td>0.522222</td>
      <td>0.211111</td>
      <td>1.0</td>
      <td>0.0</td>
      <td>1.000000</td>
      <td>0.000000</td>
      <td>0.6</td>
      <td>0.2</td>
      <td>0.7</td>
      <td>0.1</td>
      <td>0.70</td>
      <td>0.20</td>
      <td>0.666667</td>
      <td>0.166667</td>
      <td>0.533333</td>
      <td>0.183333</td>
      <td>0.511111</td>
      <td>0.155556</td>
    </tr>
  </tbody>
</table>
<p>25979 rows × 65 columns</p>
</div>



- Save the table.


```python
df_team_win_goal_rolling_features.to_csv("../data/df_team_win_goal_rolling_features.csv", index = False)
```

## 1.3. Elapsed time of goals

### Q. Are there specific times when goals are scored most?


```python
plt.figure(figsize = (20, 10))
sns.histplot(data = df_match_ingame_shot_goal, x = "elapsed")
plt.xlabel("Elapsed time of goals", fontsize = 20)
plt.ylabel("count", fontsize = 20)
plt.vlines(x = 45, ymin = 0, ymax = 3500, colors = "red", linewidth = 3)
plt.vlines(x = 90, ymin = 0, ymax = 3500, colors = "red", linewidth = 3)
plt.text(x = 33, y = 3550, s = "End of the first half", color = "red", fontsize = 15)
plt.text(x = 75, y = 3550, s = "End of the second half", color = "red", fontsize = 15)
plt.title("Histogram of the elapsed time of goals", fontsize = 25)
```




    Text(0.5, 1.0, 'Histogram of the elapsed time of goals')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_104_1.png)
    


- Elapsed time of goals is almost uniformly distributed except for the right before the end of first and second half where a lot of goals are scored.

### Q: Is there any difference in the distribution of the elapsed time of goals between winning and losing team ?


```python
df_match_ingame_shot_goal
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>event_id</th>
      <th>elapsed</th>
      <th>team_api_id</th>
      <th>category</th>
      <th>type</th>
      <th>subtype</th>
      <th>player1_api_id</th>
      <th>player2_api_id</th>
      <th>match_date</th>
      <th>match_result</th>
      <th>season</th>
      <th>home_away</th>
      <th>league_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>489042</td>
      <td>378998</td>
      <td>22</td>
      <td>10261.0</td>
      <td>goal</td>
      <td>n</td>
      <td>header</td>
      <td>37799.0</td>
      <td>38807.0</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>away</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>1</th>
      <td>489042</td>
      <td>379019</td>
      <td>24</td>
      <td>10260.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>24148.0</td>
      <td>24154.0</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>2</th>
      <td>489043</td>
      <td>375546</td>
      <td>4</td>
      <td>9825.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>26181.0</td>
      <td>39297.0</td>
      <td>2008-08-16</td>
      <td>home_win</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>3</th>
      <td>489044</td>
      <td>378041</td>
      <td>83</td>
      <td>8650.0</td>
      <td>goal</td>
      <td>n</td>
      <td>distance</td>
      <td>30853.0</td>
      <td>30889.0</td>
      <td>2008-08-16</td>
      <td>away_win</td>
      <td>2008/2009</td>
      <td>away</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>4</th>
      <td>489045</td>
      <td>376060</td>
      <td>4</td>
      <td>8654.0</td>
      <td>goal</td>
      <td>n</td>
      <td>shot</td>
      <td>23139.0</td>
      <td>36394.0</td>
      <td>2008-08-16</td>
      <td>home_win</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>39975</th>
      <td>1992228</td>
      <td>5640015</td>
      <td>71</td>
      <td>10192.0</td>
      <td>goal</td>
      <td>n</td>
      <td>NaN</td>
      <td>37554.0</td>
      <td>NaN</td>
      <td>2016-05-25</td>
      <td>away_win</td>
      <td>2015/2016</td>
      <td>away</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>39976</th>
      <td>1992229</td>
      <td>5639993</td>
      <td>58</td>
      <td>9824.0</td>
      <td>goal</td>
      <td>n</td>
      <td>NaN</td>
      <td>493418.0</td>
      <td>NaN</td>
      <td>2016-05-25</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>39977</th>
      <td>1992229</td>
      <td>5640008</td>
      <td>67</td>
      <td>10243.0</td>
      <td>goal</td>
      <td>n</td>
      <td>NaN</td>
      <td>197757.0</td>
      <td>NaN</td>
      <td>2016-05-25</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>39978</th>
      <td>1992229</td>
      <td>5640010</td>
      <td>69</td>
      <td>10243.0</td>
      <td>goal</td>
      <td>n</td>
      <td>NaN</td>
      <td>198082.0</td>
      <td>NaN</td>
      <td>2016-05-25</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Switzerland Super League</td>
    </tr>
    <tr>
      <th>39979</th>
      <td>1992229</td>
      <td>5640020</td>
      <td>76</td>
      <td>10243.0</td>
      <td>goal</td>
      <td>n</td>
      <td>NaN</td>
      <td>121080.0</td>
      <td>NaN</td>
      <td>2016-05-25</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Switzerland Super League</td>
    </tr>
  </tbody>
</table>
<p>39980 rows × 14 columns</p>
</div>




```python
win_team = pd.concat([df_match_ingame_shot_goal[(df_match_ingame_shot_goal.match_result == "home_win") & (df_match_ingame_shot_goal.home_away == "home")], 
                      df_match_ingame_shot_goal[(df_match_ingame_shot_goal.match_result == "away_win") & (df_match_ingame_shot_goal.home_away == "away")]])

lose_team = pd.concat([df_match_ingame_shot_goal[(df_match_ingame_shot_goal.match_result == "home_win") & (df_match_ingame_shot_goal.home_away == "away")], 
                      df_match_ingame_shot_goal[(df_match_ingame_shot_goal.match_result == "away_win") & (df_match_ingame_shot_goal.home_away == "home")]])
```


```python
win_team["win_lose"] = "win_team"
lose_team["win_lose"] = "lose_team"

elapsed_win_lose = pd.concat([win_team[["elapsed", "win_lose"]], lose_team[["elapsed", "win_lose"]]])
```


```python
plt.figure(figsize = (20, 10))
sns.histplot(elapsed_win_lose, x = "elapsed", hue = "win_lose")
plt.xlabel("Elapsed time of goals", fontsize = 20)
plt.ylabel("count", fontsize = 20)
plt.vlines(x = 45, ymin = 0, ymax = 3500, colors = "red", linewidth = 3)
plt.vlines(x = 90, ymin = 0, ymax = 3500, colors = "red", linewidth = 3)
plt.text(x = 33, y = 3550, s = "End of the first half", color = "red", fontsize = 15)
plt.text(x = 75, y = 3550, s = "End of the second half", color = "red", fontsize = 15)
plt.title("Histogram of the elapsed time of goals", fontsize = 25)

top = mpatches.Patch(color = "skyblue", label = 'Winning team')
bottom = mpatches.Patch(color = "orange", label = 'Losing team')
plt.legend(handles=[top, bottom], loc = "upper left", fontsize = 15)

```




    <matplotlib.legend.Legend at 0x7ff683f6e140>




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_110_1.png)
    


- The losing team scores fewer goals, but there is no difference in the overall shape of the distribution of elapsed time of goals between the winning and losing team.

### Q: Is there any difference in the distribution of the elapsed time of goals between home and away team ?


```python
plt.figure(figsize = (20, 10))
sns.histplot(df_match_ingame_shot_goal, x = "elapsed", hue = "home_away")
plt.xlabel("Elapsed time of goals", fontsize = 20)
plt.ylabel("count", fontsize = 20)
plt.vlines(x = 45, ymin = 0, ymax = 3500, colors = "red", linewidth = 3)
plt.vlines(x = 90, ymin = 0, ymax = 3500, colors = "red", linewidth = 3)
plt.text(x = 33, y = 3550, s = "End of the first half", color = "red", fontsize = 15)
plt.text(x = 75, y = 3550, s = "End of the second half", color = "red", fontsize = 15)
plt.title("Histogram of the elapsed time of goals", fontsize = 25)

top = mpatches.Patch(color = "orange", label = 'Home team')
bottom = mpatches.Patch(color = "skyblue", label = 'Away team')
plt.legend(handles=[top, bottom], loc = "upper left", fontsize = 15)



```




    <matplotlib.legend.Legend at 0x7ff683f4a740>




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_113_1.png)
    


- The away team scores fewer goals, but there is no difference in the overall shape of the distribution of elapsed time of goals between the home and away team.

$\color{magenta} \quad \rightarrow$ <font color="magenta"> The elapsed time of goals doesn't seem to make much of a difference between home & away teams or winning & losing teams. Therefore, we decided not to use it in modeling. </font>

# 2. Shot


```python
df_match_ingame_shot_shot = df_match_ingame_shot[df_match_ingame_shot.category == "shot"]
```


```python
df_match_ingame_shot_shot
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>event_id</th>
      <th>elapsed</th>
      <th>team_api_id</th>
      <th>category</th>
      <th>type</th>
      <th>subtype</th>
      <th>player1_api_id</th>
      <th>player2_api_id</th>
      <th>match_date</th>
      <th>match_result</th>
      <th>season</th>
      <th>home_away</th>
      <th>league_name</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>39980</th>
      <td>489042</td>
      <td>378828</td>
      <td>3</td>
      <td>10260.0</td>
      <td>shot</td>
      <td>shoton</td>
      <td>NaN</td>
      <td>24154.0</td>
      <td>NaN</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>39981</th>
      <td>489042</td>
      <td>378866</td>
      <td>7</td>
      <td>10260.0</td>
      <td>shot</td>
      <td>shoton</td>
      <td>NaN</td>
      <td>24157.0</td>
      <td>NaN</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>39982</th>
      <td>489042</td>
      <td>378922</td>
      <td>14</td>
      <td>10260.0</td>
      <td>shot</td>
      <td>shoton</td>
      <td>NaN</td>
      <td>30829.0</td>
      <td>NaN</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>39983</th>
      <td>489042</td>
      <td>378923</td>
      <td>14</td>
      <td>10260.0</td>
      <td>shot</td>
      <td>shoton</td>
      <td>NaN</td>
      <td>30373.0</td>
      <td>NaN</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>39984</th>
      <td>489042</td>
      <td>378951</td>
      <td>17</td>
      <td>10260.0</td>
      <td>shot</td>
      <td>shoton</td>
      <td>NaN</td>
      <td>30373.0</td>
      <td>NaN</td>
      <td>2008-08-17</td>
      <td>draw</td>
      <td>2008/2009</td>
      <td>home</td>
      <td>England Premier League</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>229033</th>
      <td>2030171</td>
      <td>4940379</td>
      <td>19</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>36130.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229034</th>
      <td>2030171</td>
      <td>4940624</td>
      <td>44</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>34104.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229035</th>
      <td>2030171</td>
      <td>4940738</td>
      <td>49</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>107930.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229036</th>
      <td>2030171</td>
      <td>4940963</td>
      <td>71</td>
      <td>8370.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>210065.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>home</td>
      <td>Spain LIGA BBVA</td>
    </tr>
    <tr>
      <th>229037</th>
      <td>2030171</td>
      <td>4941072</td>
      <td>83</td>
      <td>8558.0</td>
      <td>shot</td>
      <td>shotoff</td>
      <td>NaN</td>
      <td>629579.0</td>
      <td>NaN</td>
      <td>2015-10-23</td>
      <td>home_win</td>
      <td>2015/2016</td>
      <td>away</td>
      <td>Spain LIGA BBVA</td>
    </tr>
  </tbody>
</table>
<p>189058 rows × 14 columns</p>
</div>




```python
df_match_ingame_shot_shot.type.value_counts()
```




    shotoff    95303
    shoton     93755
    Name: type, dtype: int64



- There are two kinds of shot type: 
    - shoton: It means shot on target. Definition of the shot on target is as follow.
        - Goes into the net regardless of intent.
        - Is a clear attempt to score that would have gone into the net but for being saved by the goalkeeper or is stopped by a player who is the last line of defence with the goalkeeper having no chance of preventing the goal (last line block).
    - shotoff: It means shot off target. Definition of the shot on target is as follow.
        - Goes over or wide of the goal without making contact with another player.
        - Would have gone over or wide of the goal but for being stopped by a goalkeeper's save or by an outfield player.
        - Directly hits the frame of the goal and a goal is not scored.


```python
sns.countplot(x = df_match_ingame_shot_shot.type)
```




    <AxesSubplot:xlabel='type', ylabel='count'>




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_121_1.png)
    


- The portion of the shot on target and the shot off target out of total shot are almost same.

### Q. Are there any relationship between total number of shot, total number of shot on target, and total number of shot off target and number of goals.


```python
goal_info = df_match_ingame_shot_goal.groupby(["match_api_id", "team_api_id"]).event_id.count().reset_index().rename(columns = {"event_id": "num_goals"})
```


```python
shot_info = df_match_ingame_shot_shot.groupby(["match_api_id", "team_api_id"]).event_id.count().reset_index().rename(columns = {"event_id": "num_shots"})
```


```python
shot_on_info = df_match_ingame_shot_shot[df_match_ingame_shot_shot.type == "shoton"].groupby(["match_api_id", "team_api_id"]).event_id.count().reset_index().rename(columns = {"event_id": "num_shots_on"})
```


```python
shot_off_info = df_match_ingame_shot_shot[df_match_ingame_shot_shot.type == "shotoff"].groupby(["match_api_id", "team_api_id"]).event_id.count().reset_index().rename(columns = {"event_id": "num_shots_off"})
```


```python
goal_shot_info = shot_info.merge(goal_info, how = "left", on = ["match_api_id", "team_api_id"]) \
                          .merge(shot_on_info, how = "left", on = ["match_api_id", "team_api_id"]) \
                          .merge(shot_off_info, how = "left", on = ["match_api_id", "team_api_id"]) \
                          [["match_api_id", "team_api_id", "num_shots_on", "num_shots_off", "num_shots", "num_goals"]] \
                          .fillna(0)
    
```


```python
goal_shot_info[["num_shots_on", "num_shots_off", "num_shots", "num_goals"]].corr()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>num_shots_on</th>
      <th>num_shots_off</th>
      <th>num_shots</th>
      <th>num_goals</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>num_shots_on</th>
      <td>1.000000</td>
      <td>0.328353</td>
      <td>0.827919</td>
      <td>0.105083</td>
    </tr>
    <tr>
      <th>num_shots_off</th>
      <td>0.328353</td>
      <td>1.000000</td>
      <td>0.801601</td>
      <td>0.061156</td>
    </tr>
    <tr>
      <th>num_shots</th>
      <td>0.827919</td>
      <td>0.801601</td>
      <td>1.000000</td>
      <td>0.102825</td>
    </tr>
    <tr>
      <th>num_goals</th>
      <td>0.105083</td>
      <td>0.061156</td>
      <td>0.102825</td>
      <td>1.000000</td>
    </tr>
  </tbody>
</table>
</div>



- If we check the correlations, the number of shot on target and the number of shots have higher correlation with the number of goals than the number of shot off.

### Q. Is there any difference in the distribution of number of shots between winning team and losing team ?


```python
target_bool = ((df_match_ingame_shot_shot.match_result == "home_win") & (df_match_ingame_shot_shot.home_away == "home")) | ((df_match_ingame_shot_shot.match_result == "away_win") & (df_match_ingame_shot_shot.home_away == "away"))
win_shot_info = df_match_ingame_shot_shot[target_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "values"})
win_shot_info["category"] = "shots"
win_shot_info["win_loss"] = "win"
```


```python
target_bool = ((df_match_ingame_shot_shot.match_result == "home_win") & (df_match_ingame_shot_shot.home_away == "away")) | ((df_match_ingame_shot_shot.match_result == "away_win") & (df_match_ingame_shot_shot.home_away == "home"))
lose_shot_info = df_match_ingame_shot_shot[target_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "values"})
lose_shot_info["category"] = "shots"
lose_shot_info["win_loss"] = "lose"
```


```python
target_bool = ((df_match_ingame_shot_shot.match_result == "home_win") & (df_match_ingame_shot_shot.home_away == "home")) | ((df_match_ingame_shot_shot.match_result == "away_win") & (df_match_ingame_shot_shot.home_away == "away"))
shot_on_bool = df_match_ingame_shot_shot.type == "shoton"
win_shot_on_info = df_match_ingame_shot_shot[target_bool & shot_on_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "values"})
win_shot_on_info["category"] = "shot_on"
win_shot_on_info["win_loss"] = "win"
```


```python
target_bool = ((df_match_ingame_shot_shot.match_result == "home_win") & (df_match_ingame_shot_shot.home_away == "away")) | ((df_match_ingame_shot_shot.match_result == "away_win") & (df_match_ingame_shot_shot.home_away == "home"))
shot_on_bool = df_match_ingame_shot_shot.type == "shoton"
lose_shot_on_info = df_match_ingame_shot_shot[target_bool & shot_on_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "values"})
lose_shot_on_info["category"] = "shot_on"
lose_shot_on_info["win_loss"] = "lose"
```


```python
target_bool = ((df_match_ingame_shot_shot.match_result == "home_win") & (df_match_ingame_shot_shot.home_away == "home")) | ((df_match_ingame_shot_shot.match_result == "away_win") & (df_match_ingame_shot_shot.home_away == "away"))
shot_on_bool = df_match_ingame_shot_shot.type == "shotoff"
win_shot_off_info = df_match_ingame_shot_shot[target_bool & shot_on_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "values"})
win_shot_off_info["category"] = "shot_off"
win_shot_off_info["win_loss"] = "win"
```


```python
target_bool = ((df_match_ingame_shot_shot.match_result == "home_win") & (df_match_ingame_shot_shot.home_away == "away")) | ((df_match_ingame_shot_shot.match_result == "away_win") & (df_match_ingame_shot_shot.home_away == "home"))
shot_on_bool = df_match_ingame_shot_shot.type == "shotoff"
lose_shot_off_info = df_match_ingame_shot_shot[target_bool & shot_on_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "values"})
lose_shot_off_info["category"] = "shot_off"
lose_shot_off_info["win_loss"] = "lose"
```


```python
win_lose_shot_info = pd.concat([win_shot_info, lose_shot_info, win_shot_on_info, lose_shot_on_info, win_shot_off_info, lose_shot_off_info])
```


```python
fig, axes = plt.subplots(1, 3, figsize = (18, 5))

sns.histplot(data = win_lose_shot_info[win_lose_shot_info.category == "shots"], x = "values", hue = "win_loss", ax = axes[0])
axes[0].set_xlabel("Total number of shots", fontsize = 15)
axes[0].set_ylabel("Count", fontsize = 15)

sns.histplot(data = win_lose_shot_info[win_lose_shot_info.category == "shot_on"], x = "values", hue = "win_loss", ax = axes[1])
axes[1].set_xlabel("Total number of shots on target", fontsize = 15)
axes[1].set_ylabel("Count", fontsize = 15)

sns.histplot(data = win_lose_shot_info[win_lose_shot_info.category == "shot_off"], x = "values", hue = "win_loss", ax = axes[2])
axes[2].set_xlabel("Total number of shots off target", fontsize = 15)
axes[2].set_ylabel("Count", fontsize = 15)


```




    Text(0, 0.5, 'Count')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_139_1.png)
    


- The shape of the distribution of the winning team and the losing team is the same, but the distribution of the winning team is shifted slightly to the right.
- It can be seen that the winning teams took slightly more shots overall.

### Q. Is there any difference of shot on target ratio(the number of shots on target / the number of shots) between winnint team and losing team ?


```python
win_lose_shot_info = win_shot_info[["match_api_id", "values"]].rename(columns = {"values": "win_num_shots"}).merge(lose_shot_info[["match_api_id", "values"]].rename(columns = {"values": "lose_num_shots"}), how = "left", on = "match_api_id") \
                                                                                                            .merge(win_shot_on_info[["match_api_id", "values"]].rename(columns = {"values": "win_num_shot_on"}), how = "left", on = "match_api_id") \
                                                                                                            .merge(lose_shot_on_info[["match_api_id", "values"]].rename(columns = {"values": "lose_num_shot_on"}), how = "left", on = "match_api_id") \
                                                                                                            .merge(win_shot_off_info[["match_api_id", "values"]].rename(columns = {"values": "win_num_shot_off"}), how = "left", on = "match_api_id") \
                                                                                                            .merge(lose_shot_off_info[["match_api_id", "values"]].rename(columns = {"values": "lose_num_shot_off"}), how = "left", on = "match_api_id")    
```


```python
win_lose_shot_info["win_shot_ratio"] = win_lose_shot_info.win_num_shot_on / win_lose_shot_info.win_num_shots
win_lose_shot_info["lose_shot_ratio"] = win_lose_shot_info.lose_num_shot_on / win_lose_shot_info.lose_num_shots
win_lose_shot_info["shot_on_target_ratio_difference"] = win_lose_shot_info.win_shot_ratio - win_lose_shot_info.lose_shot_ratio

```


```python
my_histogram(win_lose_shot_info, "shot_on_target_ratio_difference")
```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_144_0.png)
    


- Above plot shows the histogram of the shot on target ratio difference between the winning team and the losing team.
- There are also half of the matches where the losing team had the higher shot on target ratio.
- Since the distribution is symmetric, it is difficult to say that the winning team had the particularly higher shot on target ratio than that of the losing team.

### Q. Is there any difference in the distribution of number of shots between home team and away team ?


```python
home_shot_info = df_match_ingame_shot_shot[df_match_ingame_shot_shot.home_away == "home"].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "home_num_shots"}).drop("team_api_id", axis = 1)
away_shot_info = df_match_ingame_shot_shot[df_match_ingame_shot_shot.home_away == "away"].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "away_num_shots"}).drop("team_api_id", axis = 1)

target_bool = (df_match_ingame_shot_shot.home_away == "home") & (df_match_ingame_shot_shot.type == "shoton")
home_shot_on_info = df_match_ingame_shot_shot[target_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "home_num_shots_on"}).drop("team_api_id", axis = 1)

target_bool = (df_match_ingame_shot_shot.home_away == "away") & (df_match_ingame_shot_shot.type == "shoton")
away_shot_on_info = df_match_ingame_shot_shot[target_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "away_num_shots_on"}).drop("team_api_id", axis = 1)

target_bool = (df_match_ingame_shot_shot.home_away == "home") & (df_match_ingame_shot_shot.type == "shotoff")
home_shot_off_info = df_match_ingame_shot_shot[target_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "home_num_shots_off"}).drop("team_api_id", axis = 1)

target_bool = (df_match_ingame_shot_shot.home_away == "away") & (df_match_ingame_shot_shot.type == "shotoff")
away_shot_off_info = df_match_ingame_shot_shot[target_bool].groupby(["match_api_id", "team_api_id"]).count().event_id.reset_index().rename(columns = {"event_id": "away_num_shots_off"}).drop("team_api_id", axis = 1)
```


```python
home_away_shot_info = home_shot_info.merge(away_shot_info, how = "left", on = "match_api_id") \
                                    .merge(home_shot_on_info, how = "left", on = "match_api_id") \
                                    .merge(away_shot_on_info, how = "left", on = "match_api_id") \
                                    .merge(home_shot_off_info, how = "left", on = "match_api_id") \
                                    .merge(away_shot_off_info, how = "left", on = "match_api_id")
    
```


```python
home_away_shot_info
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_num_shots</th>
      <th>away_num_shots</th>
      <th>home_num_shots_on</th>
      <th>away_num_shots_on</th>
      <th>home_num_shots_off</th>
      <th>away_num_shots_off</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>489042</td>
      <td>21</td>
      <td>10.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>10.0</td>
      <td>9.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>489043</td>
      <td>25</td>
      <td>5.0</td>
      <td>12.0</td>
      <td>2.0</td>
      <td>13.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>489044</td>
      <td>7</td>
      <td>16.0</td>
      <td>4.0</td>
      <td>11.0</td>
      <td>3.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>489045</td>
      <td>12</td>
      <td>22.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>15.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>489046</td>
      <td>9</td>
      <td>14.0</td>
      <td>5.0</td>
      <td>9.0</td>
      <td>4.0</td>
      <td>5.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>8457</th>
      <td>2060642</td>
      <td>10</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>5.0</td>
      <td>8.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>8458</th>
      <td>2060643</td>
      <td>17</td>
      <td>12.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>9.0</td>
      <td>4.0</td>
    </tr>
    <tr>
      <th>8459</th>
      <td>2060644</td>
      <td>16</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>8.0</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>8460</th>
      <td>2060645</td>
      <td>8</td>
      <td>15.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>8461</th>
      <td>2118418</td>
      <td>10</td>
      <td>8.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>4.0</td>
      <td>2.0</td>
    </tr>
  </tbody>
</table>
<p>8462 rows × 7 columns</p>
</div>




```python
fig, axes = plt.subplots(1, 3, figsize = (18, 5))

sns.histplot(data = home_away_shot_info[["home_num_shots", "away_num_shots"]].melt(), x = "value", hue = "variable", ax = axes[0])
axes[0].set_xlabel("Total number of shots", fontsize = 15)
axes[0].set_ylabel("Count", fontsize = 15)

sns.histplot(data = home_away_shot_info[["home_num_shots_on", "away_num_shots_on"]].melt(), x = "value", hue = "variable", ax = axes[1])
axes[1].set_xlabel("Total number of shots on target", fontsize = 15)
axes[1].set_ylabel("Count", fontsize = 15)

sns.histplot(data = home_away_shot_info[["home_num_shots_off", "away_num_shots_off"]].melt(), x = "value", hue = "variable", ax = axes[2])
axes[2].set_xlabel("Total number of shots off target", fontsize = 15)
axes[2].set_ylabel("Count", fontsize = 15)
```




    Text(0, 0.5, 'Count')




    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_150_1.png)
    


- The shape of the distribution of the home team and the away team is the same, but the distribution of the home team is shifted slightly to the right.
- It can be seen that the home teams took slightly more shots overall.

### Q. Is there any difference of shot on target ratio(the number of shots on target / the number of shots) between home team and away team ?


```python
home_away_shot_info["home_shot_on_target_ratio"] = home_away_shot_info.home_num_shots_on / home_away_shot_info.home_num_shots
home_away_shot_info["away_shot_on_target_ratio"] = home_away_shot_info.away_num_shots_on / home_away_shot_info.away_num_shots
home_away_shot_info["shot_on_target_ratio_difference"] = home_away_shot_info.home_shot_on_target_ratio - home_away_shot_info.away_shot_on_target_ratio
```


```python
my_histogram(home_away_shot_info, "shot_on_target_ratio_difference")
```


    
![png](/assets/images/projects/european_soccer_prediction/2.4.eda_match_ingame_shot_154_0.png)
    


- Above plot shows the histogram of the shot on target ratio difference between the home team and the away team.
- There are also half of the matches where the away team had the higher shot on target ratio.
- Since the distribution is symmetric, it is difficult to say that the home team had the particularly higher shot on target ratio than that of the away team.

<font color="magenta"> - We have found that:  
   
$\\ \quad$ - The number of shots and the number of shots on target have higher correlation with the number of goals than the number of shot off target    
  
$\\ \quad$ - The shot on target ratio (the number of shots on target / total number of shots) have no difference between winning team and the losing team.
    
$\\ \quad$ - The shot on target ratio (the number of shots on target / total number of shots) have no difference between home team and the away team.
    
$\\ \quad$ - The winning teams usually have more shots, shots on target, and shots off target than those of the losing teams.
    
$\\ \quad$ - The home teams usually have more shots, shots on target, and shots off target than those of the away teams.
    
$\\ \quad \rightarrow$ Of the three shot related variables(totla number of shots, number of shots on target, number of shots off target), consider only the total number of shots.

</font>

- Let's check whether we can use the variables related to the number of shots for modeling.


```python
df_match_ingame_shot_shot.match_api_id.drop_duplicates()
```




    39980      489042
    39992      489043
    40006      489044
    40021      489045
    40033      489046
               ...   
    133702    2030168
    133709    2030169
    133714    2030170
    133724    2030171
    177951     499537
    Name: match_api_id, Length: 8464, dtype: int64




```python
df_match_basic.match_api_id.drop_duplicates()
```




    0         492473
    1         492474
    2         492475
    3         492476
    4         492477
              ...   
    25974    1992091
    25975    1992092
    25976    1992093
    25977    1992094
    25978    1992095
    Name: match_api_id, Length: 25979, dtype: int64



- Total number of matches: 25,979
- The number of matches that we have information about shots: 8,464
$\rightarrow$ That is, there are only 30% matches that have shots information. So it is hard to use the information related to the shots for training the model.   

     
$\color{magenta} \quad \rightarrow$ <font color="magenta"> So, we can show information related to number of shots into a dashboard later, but it is hard to use this information for modeling because there are too many matches that we don't have the shots information.
</font>

# <font color="magenta">3. Summary</font>

- Create a variable for each team that indicates how well they score goals when home, how well they block goals when home, how well they score goals when away, and how well they block goals when away:    
    - Each team's last 1 / 3 / 5 / 10 / 20 / 30 / 60 / 90 matches    
        - average goal at home                               
        - average opponent's goal at home 
        - average goal at away 
        - average opponent's goal at away 

- Also, use the each team's win or lose percentage at home and away for recent 1 / 3 / 5 / 10 / 20 / 30 / 60 / 90 matches.

- We can show information related to number of shots into a dashboard later, but it is hard to use this information for modeling because there are too many matches that we don't have the shots information.

![2.4.summary](../images/df_shot_rolling_summary.png)


