---
layout: single
title: "2 - 2. EDA - Match player information"
permalink: /projects/european_soccer_prediction/2.2.eda_match_player/
comments: false
author_profile: true
read_time: true
toc: true
toc_label: "Table of Contents"
toc_sticky: true
categories: ["european_soccer_prediction"]
---

```python
import numpy as np 
import pandas as pd 

import sqlite3 as sql 

import matplotlib.pyplot as plt 
import seaborn as sns 
import missingno as msno 
from utils import my_histogram
```


```python
import warnings
warnings.filterwarnings('ignore')
```


```python
pd.set_option('display.max_columns', None)
```


```python
df_match_player = pd.read_csv("../data/df_match_player.csv")
df_match_player
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_player_X1</th>
      <th>home_player_X2</th>
      <th>home_player_X3</th>
      <th>home_player_X4</th>
      <th>home_player_X5</th>
      <th>home_player_X6</th>
      <th>home_player_X7</th>
      <th>home_player_X8</th>
      <th>home_player_X9</th>
      <th>home_player_X10</th>
      <th>home_player_X11</th>
      <th>away_player_X1</th>
      <th>away_player_X2</th>
      <th>away_player_X3</th>
      <th>away_player_X4</th>
      <th>away_player_X5</th>
      <th>away_player_X6</th>
      <th>away_player_X7</th>
      <th>away_player_X8</th>
      <th>away_player_X9</th>
      <th>away_player_X10</th>
      <th>away_player_X11</th>
      <th>home_player_Y1</th>
      <th>home_player_Y2</th>
      <th>home_player_Y3</th>
      <th>home_player_Y4</th>
      <th>home_player_Y5</th>
      <th>home_player_Y6</th>
      <th>home_player_Y7</th>
      <th>home_player_Y8</th>
      <th>home_player_Y9</th>
      <th>home_player_Y10</th>
      <th>home_player_Y11</th>
      <th>away_player_Y1</th>
      <th>away_player_Y2</th>
      <th>away_player_Y3</th>
      <th>away_player_Y4</th>
      <th>away_player_Y5</th>
      <th>away_player_Y6</th>
      <th>away_player_Y7</th>
      <th>away_player_Y8</th>
      <th>away_player_Y9</th>
      <th>away_player_Y10</th>
      <th>away_player_Y11</th>
      <th>home_player_1</th>
      <th>home_player_2</th>
      <th>home_player_3</th>
      <th>home_player_4</th>
      <th>home_player_5</th>
      <th>home_player_6</th>
      <th>home_player_7</th>
      <th>home_player_8</th>
      <th>home_player_9</th>
      <th>home_player_10</th>
      <th>home_player_11</th>
      <th>away_player_1</th>
      <th>away_player_2</th>
      <th>away_player_3</th>
      <th>away_player_4</th>
      <th>away_player_5</th>
      <th>away_player_6</th>
      <th>away_player_7</th>
      <th>away_player_8</th>
      <th>away_player_9</th>
      <th>away_player_10</th>
      <th>away_player_11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>492473</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492474</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>492475</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>492476</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>492477</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>42231.0</td>
      <td>678384.0</td>
      <td>95220.0</td>
      <td>638592.0</td>
      <td>413155.0</td>
      <td>45780.0</td>
      <td>171229.0</td>
      <td>67333.0</td>
      <td>119839.0</td>
      <td>143790.0</td>
      <td>195215.0</td>
      <td>462944.0</td>
      <td>563066.0</td>
      <td>8800.0</td>
      <td>67304.0</td>
      <td>158253.0</td>
      <td>133126.0</td>
      <td>186524.0</td>
      <td>93223.0</td>
      <td>121115.0</td>
      <td>232110.0</td>
      <td>289732.0</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>9.0</td>
      <td>11.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>33272.0</td>
      <td>41621.0</td>
      <td>25813.0</td>
      <td>257845.0</td>
      <td>114735.0</td>
      <td>42237.0</td>
      <td>113227.0</td>
      <td>358156.0</td>
      <td>32343.0</td>
      <td>531309.0</td>
      <td>37257.0</td>
      <td>42276.0</td>
      <td>114792.0</td>
      <td>150007.0</td>
      <td>178119.0</td>
      <td>27232.0</td>
      <td>570830.0</td>
      <td>260708.0</td>
      <td>201704.0</td>
      <td>36382.0</td>
      <td>34082.0</td>
      <td>95257.0</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>157856.0</td>
      <td>274779.0</td>
      <td>177689.0</td>
      <td>294256.0</td>
      <td>42258.0</td>
      <td>39979.0</td>
      <td>173936.0</td>
      <td>147959.0</td>
      <td>451983.0</td>
      <td>80564.0</td>
      <td>289472.0</td>
      <td>10637.0</td>
      <td>67349.0</td>
      <td>202663.0</td>
      <td>32597.0</td>
      <td>114794.0</td>
      <td>188114.0</td>
      <td>25840.0</td>
      <td>482200.0</td>
      <td>95230.0</td>
      <td>451335.0</td>
      <td>275122.0</td>
    </tr>
    <tr>
      <th>25977</th>
      <td>1992094</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>NaN</td>
      <td>8881.0</td>
      <td>173534.0</td>
      <td>39646.0</td>
      <td>282287.0</td>
      <td>340790.0</td>
      <td>393337.0</td>
      <td>8893.0</td>
      <td>614454.0</td>
      <td>93229.0</td>
      <td>178142.0</td>
      <td>274776.0</td>
      <td>121080.0</td>
      <td>197757.0</td>
      <td>260964.0</td>
      <td>231614.0</td>
      <td>113235.0</td>
      <td>41116.0</td>
      <td>462608.0</td>
      <td>42262.0</td>
      <td>92252.0</td>
      <td>194532.0</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>274787.0</td>
      <td>492132.0</td>
      <td>108451.0</td>
      <td>25815.0</td>
      <td>94553.0</td>
      <td>384376.0</td>
      <td>598355.0</td>
      <td>36785.0</td>
      <td>45174.0</td>
      <td>302079.0</td>
      <td>71764.0</td>
      <td>156175.0</td>
      <td>95216.0</td>
      <td>172768.0</td>
      <td>22834.0</td>
      <td>458806.0</td>
      <td>207234.0</td>
      <td>25772.0</td>
      <td>40274.0</td>
      <td>34035.0</td>
      <td>41726.0</td>
      <td>527103.0</td>
    </tr>
  </tbody>
</table>
<p>25979 rows × 67 columns</p>
</div>



- There are 2 kinds of information in the df_match_player.
    - player position: home_player_X#, home_player_Y#, away_player_X#, away_player_Y# where # $\in [1, 11]$
    - starting lineup: home_player_#, away_player_# where # $\in [1, 11]$

# 1. Player position


```python
player_position_col = ["match_api_id", 'home_player_X1', 'home_player_X2', 'home_player_X3',
                       'home_player_X4', 'home_player_X5', 'home_player_X6', 
                       'home_player_X7', 'home_player_X8', 'home_player_X9', 
                       'home_player_X10','home_player_X11', 'away_player_X1', 
                       'away_player_X2', 'away_player_X3', 'away_player_X4', 
                       'away_player_X5', 'away_player_X6', 'away_player_X7',
                       'away_player_X8', 'away_player_X9', 'away_player_X10',
                       'away_player_X11', 'home_player_Y1', 'home_player_Y2', 
                       'home_player_Y3', 'home_player_Y4', 'home_player_Y5', 
                       'home_player_Y6', 'home_player_Y7', 'home_player_Y8', 
                       'home_player_Y9', 'home_player_Y10', 'home_player_Y11', 
                       'away_player_Y1', 'away_player_Y2', 'away_player_Y3',
                       'away_player_Y4', 'away_player_Y5', 'away_player_Y6', 
                       'away_player_Y7', 'away_player_Y8', 'away_player_Y9', 
                       'away_player_Y10', 'away_player_Y11']
```


```python
df_match_player_position = df_match_player[player_position_col]
df_match_player_position
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_player_X1</th>
      <th>home_player_X2</th>
      <th>home_player_X3</th>
      <th>home_player_X4</th>
      <th>home_player_X5</th>
      <th>home_player_X6</th>
      <th>home_player_X7</th>
      <th>home_player_X8</th>
      <th>home_player_X9</th>
      <th>home_player_X10</th>
      <th>home_player_X11</th>
      <th>away_player_X1</th>
      <th>away_player_X2</th>
      <th>away_player_X3</th>
      <th>away_player_X4</th>
      <th>away_player_X5</th>
      <th>away_player_X6</th>
      <th>away_player_X7</th>
      <th>away_player_X8</th>
      <th>away_player_X9</th>
      <th>away_player_X10</th>
      <th>away_player_X11</th>
      <th>home_player_Y1</th>
      <th>home_player_Y2</th>
      <th>home_player_Y3</th>
      <th>home_player_Y4</th>
      <th>home_player_Y5</th>
      <th>home_player_Y6</th>
      <th>home_player_Y7</th>
      <th>home_player_Y8</th>
      <th>home_player_Y9</th>
      <th>home_player_Y10</th>
      <th>home_player_Y11</th>
      <th>away_player_Y1</th>
      <th>away_player_Y2</th>
      <th>away_player_Y3</th>
      <th>away_player_Y4</th>
      <th>away_player_Y5</th>
      <th>away_player_Y6</th>
      <th>away_player_Y7</th>
      <th>away_player_Y8</th>
      <th>away_player_Y9</th>
      <th>away_player_Y10</th>
      <th>away_player_Y11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>492473</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>1</th>
      <td>492474</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>2</th>
      <td>492475</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>3</th>
      <td>492476</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>4</th>
      <td>492477</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
      <td>NaN</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>9.0</td>
      <td>11.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>25977</th>
      <td>1992094</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>5.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>6.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>8.0</td>
      <td>11.0</td>
    </tr>
  </tbody>
</table>
<p>25979 rows × 45 columns</p>
</div>



- The X and Y variables identify the position of the player on the field. \
- The field is divided X and Y coordinates. 
    - the X coordinates are on the goalline ranging 1-9
    - the Y coordinates are along the length of the field ranging 1-11.
- All keepers have coordinates (1,1), while all field players can have an X-coordinate 2-9 and an Y-coordinate 2-11. 
- (ex) If the second field player of the hometeam has coordinates (2,3), (thus: home_player_X2 = 2 and home_player_Y2 = 3), you can infer he plays on the left side of the field (X=2) as a defender (Y=3). He must thus be a left defender in this match.
- The distinction between defender, midfielder, forward is a bit arbitrary. I assume that Y coordinates between 2 and 5 are defenders, Y coordinates between 6 and 8 are midfielders and Y coordinates 9-11 are forwards.

(https://www.kaggle.com/datasets/hugomathien/soccer/discussion/30200#176414)


```python
df_match_player_position.isna().sum()
```




    match_api_id          0
    home_player_X1     1821
    home_player_X2     1821
    home_player_X3     1832
    home_player_X4     1832
    home_player_X5     1832
    home_player_X6     1832
    home_player_X7     1832
    home_player_X8     1832
    home_player_X9     1832
    home_player_X10    1832
    home_player_X11    1832
    away_player_X1     1832
    away_player_X2     1832
    away_player_X3     1832
    away_player_X4     1832
    away_player_X5     1832
    away_player_X6     1832
    away_player_X7     1832
    away_player_X8     1832
    away_player_X9     1833
    away_player_X10    1833
    away_player_X11    1839
    home_player_Y1     1821
    home_player_Y2     1821
    home_player_Y3     1832
    home_player_Y4     1832
    home_player_Y5     1832
    home_player_Y6     1832
    home_player_Y7     1832
    home_player_Y8     1832
    home_player_Y9     1832
    home_player_Y10    1832
    home_player_Y11    1832
    away_player_Y1     1832
    away_player_Y2     1832
    away_player_Y3     1832
    away_player_Y4     1832
    away_player_Y5     1832
    away_player_Y6     1832
    away_player_Y7     1832
    away_player_Y8     1832
    away_player_Y9     1833
    away_player_Y10    1833
    away_player_Y11    1839
    dtype: int64




```python
msno.matrix(df_match_player_position)
```




    <AxesSubplot:>




    
![png](/assets/images/projects/european_soccer_prediction/2.2.eda_match_player_10_1.png)
    


- Ther are about 1800 missing values from each column.
- There is a pattern in the missing values: If one position column has missing value, all other position columns aslo have missing value.

- Let's check the missing values from the player starting lineup together.


```python
msno.matrix(df_match_player)
```




    <AxesSubplot:>




    
![png](/assets/images/projects/european_soccer_prediction/2.2.eda_match_player_13_1.png)
    


- If there is a missing value in the player position, starting lineup columns also have the missing values.
- Since starting lineups are very important features, let's just drop the matches that have the missing values in the player positions and the starting lineups columns.


```python
df_match_player = df_match_player.dropna()
df_match_player.shape
```




    (21361, 67)



- After drop the matches, we have 21,361 matches. (25,979 matches -> 21,351 matches)


```python
df_match_player_position = df_match_player[player_position_col]
```

- Save the updated the train and test match_api_id list.


```python
target_id = df_match_player_position.match_api_id.unique()
```


```python
train_match_api_id = pd.read_csv("../data/train_match_api_id.csv")
train_match_api_id.shape
```




    (22653, 1)




```python
train_match_api_id = train_match_api_id[train_match_api_id.match_api_id.isin(target_id)]
train_match_api_id.shape
```




    (18343, 1)



- After drop the matches that don't have player position and lineup information, train matches become 22,653 -> 18,343 


```python
test_match_api_id = pd.read_csv("../data/test_match_api_id.csv")
test_match_api_id.shape
```




    (3326, 1)




```python
test_match_api_id = test_match_api_id[test_match_api_id.match_api_id.isin(target_id)]
test_match_api_id.shape
```




    (3018, 1)



- After drop the matches that don't have player position and lineup information, test matches become 3,326 -> 3,018


```python
train_match_api_id.to_csv("../data/train_match_api_id.csv", index = False)
test_match_api_id.to_csv("../data/test_match_api_id.csv", index = False)
```

## 1.1. Formation

- We can compress the X, Y position information of 11 players (22 columns) into one formation information by using the characteristics of these variables.


```python
df_match_player_position.home_player_X1.unique()
```




    array([1.])




```python
df_match_player_position.home_player_Y1.unique()
```




    array([1.])




```python
df_match_player_position.away_player_X1.unique()
```




    array([1.])




```python
df_match_player_position.away_player_Y1.unique()
```




    array([1.])



- Home and away player 1 awlays have (X = 1, Y = 1) position.


```python
df_match_player_position[df_match_player_position.match_api_id == 493017]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_player_X1</th>
      <th>home_player_X2</th>
      <th>home_player_X3</th>
      <th>home_player_X4</th>
      <th>home_player_X5</th>
      <th>home_player_X6</th>
      <th>home_player_X7</th>
      <th>home_player_X8</th>
      <th>home_player_X9</th>
      <th>home_player_X10</th>
      <th>home_player_X11</th>
      <th>away_player_X1</th>
      <th>away_player_X2</th>
      <th>away_player_X3</th>
      <th>away_player_X4</th>
      <th>away_player_X5</th>
      <th>away_player_X6</th>
      <th>away_player_X7</th>
      <th>away_player_X8</th>
      <th>away_player_X9</th>
      <th>away_player_X10</th>
      <th>away_player_X11</th>
      <th>home_player_Y1</th>
      <th>home_player_Y2</th>
      <th>home_player_Y3</th>
      <th>home_player_Y4</th>
      <th>home_player_Y5</th>
      <th>home_player_Y6</th>
      <th>home_player_Y7</th>
      <th>home_player_Y8</th>
      <th>home_player_Y9</th>
      <th>home_player_Y10</th>
      <th>home_player_Y11</th>
      <th>away_player_Y1</th>
      <th>away_player_Y2</th>
      <th>away_player_Y3</th>
      <th>away_player_Y4</th>
      <th>away_player_Y5</th>
      <th>away_player_Y6</th>
      <th>away_player_Y7</th>
      <th>away_player_Y8</th>
      <th>away_player_Y9</th>
      <th>away_player_Y10</th>
      <th>away_player_Y11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>145</th>
      <td>493017</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
    </tr>
  </tbody>
</table>
</div>



- In match_api_id = 493017, home_player_X# are: 1 / 2, 4, 6, 8 / 2, 4, 6, 8 / 4, 6
- The first player's X position is 1 and is always goalkeeper.
- The X position of the remaining 10 players shows a pattern of increasing, then decreasing, and then increasing again.
- Based on this decreasing part, we can figure out the formation.
- In this case, the formation is 4-4-2.


```python
df_match_player_position[df_match_player_position.match_api_id == 1992092]
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_player_X1</th>
      <th>home_player_X2</th>
      <th>home_player_X3</th>
      <th>home_player_X4</th>
      <th>home_player_X5</th>
      <th>home_player_X6</th>
      <th>home_player_X7</th>
      <th>home_player_X8</th>
      <th>home_player_X9</th>
      <th>home_player_X10</th>
      <th>home_player_X11</th>
      <th>away_player_X1</th>
      <th>away_player_X2</th>
      <th>away_player_X3</th>
      <th>away_player_X4</th>
      <th>away_player_X5</th>
      <th>away_player_X6</th>
      <th>away_player_X7</th>
      <th>away_player_X8</th>
      <th>away_player_X9</th>
      <th>away_player_X10</th>
      <th>away_player_X11</th>
      <th>home_player_Y1</th>
      <th>home_player_Y2</th>
      <th>home_player_Y3</th>
      <th>home_player_Y4</th>
      <th>home_player_Y5</th>
      <th>home_player_Y6</th>
      <th>home_player_Y7</th>
      <th>home_player_Y8</th>
      <th>home_player_Y9</th>
      <th>home_player_Y10</th>
      <th>home_player_Y11</th>
      <th>away_player_Y1</th>
      <th>away_player_Y2</th>
      <th>away_player_Y3</th>
      <th>away_player_Y4</th>
      <th>away_player_Y5</th>
      <th>away_player_Y6</th>
      <th>away_player_Y7</th>
      <th>away_player_Y8</th>
      <th>away_player_Y9</th>
      <th>away_player_Y10</th>
      <th>away_player_Y11</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>5.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>1.0</td>
      <td>2.0</td>
      <td>4.0</td>
      <td>6.0</td>
      <td>8.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>3.0</td>
      <td>5.0</td>
      <td>7.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>9.0</td>
      <td>11.0</td>
      <td>11.0</td>
      <td>1.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>3.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>7.0</td>
      <td>10.0</td>
      <td>10.0</td>
      <td>10.0</td>
    </tr>
  </tbody>
</table>
</div>



- In match_api_id = 1992092, home_player_X# are 1 / 3, 5, 7 / 2, 4, 6, 8 / 5 / 4, 6
- In this case, the formation is 3-4-1-2.

- Let's make the formation column by using above information.


```python
df_match_player_position_home = df_match_player_position[["match_api_id", 'home_player_X2', 'home_player_X3',
                                                          'home_player_X4', 'home_player_X5', 'home_player_X6', 
                                                          'home_player_X7', 'home_player_X8', 'home_player_X9', 
                                                          'home_player_X10','home_player_X11']]
```


```python
df_match_player_position_away = df_match_player_position[["match_api_id", 'away_player_X2', 'away_player_X3',
                                                          'away_player_X4', 'away_player_X5', 'away_player_X6', 
                                                          'away_player_X7', 'away_player_X8', 'away_player_X9', 
                                                          'away_player_X10','away_player_X11']]
```


```python
home_formation_list = []

for match_api_id in df_match_player_position_home.match_api_id:
    position_array = df_match_player_position_home[df_match_player_position_home.match_api_id == match_api_id].values[0][1:]
    
    position_temp = position_array[1:]
    position_temp_shift = position_array[: -1]
    res = ((position_temp - position_temp_shift) > 0)
    
    target_index = np.where(res== False)[0]
    
    formation_temp = []

    before_index = 0
    for i in target_index:
        formation_temp.append(sum(res[before_index:i]) + 1)
        before_index = i 
    
    formation_temp.append(10 - sum(formation_temp))
    
    formation_res = "".join(str(x) for x in formation_temp)
    
    home_formation_list.append(formation_res)
```


```python
away_formation_list = []

for match_api_id in df_match_player_position_home.match_api_id:
    position_array = df_match_player_position_away[df_match_player_position_away.match_api_id == match_api_id].values[0][1:]
    
    position_temp = position_array[1:]
    position_temp_shift = position_array[: -1]
    res = ((position_temp - position_temp_shift) > 0)
    
    target_index = np.where(res== False)[0]
    
    formation_temp = []

    before_index = 0
    for i in target_index:
        formation_temp.append(sum(res[before_index:i]) + 1)
        before_index = i 
    
    formation_temp.append(10 - sum(formation_temp))
    
    formation_res = "".join(str(x) for x in formation_temp)
    
    away_formation_list.append(formation_res)
```


```python
df_match_formation = pd.DataFrame({"match_api_id": df_match_player.match_api_id,
                                  "home_formation_by_X": home_formation_list,
                                  "away_formation_by_X": away_formation_list})
df_match_formation
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_formation_by_X</th>
      <th>away_formation_by_X</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>145</th>
      <td>493017</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>153</th>
      <td>493025</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>155</th>
      <td>493027</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>162</th>
      <td>493034</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>168</th>
      <td>493040</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25972</th>
      <td>1992089</td>
      <td>442</td>
      <td>4231</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>4231</td>
      <td>4231</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>3412</td>
      <td>433</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>4231</td>
      <td>4231</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>442</td>
      <td>4231</td>
    </tr>
  </tbody>
</table>
<p>21361 rows × 3 columns</p>
</div>




```python
pd.concat([df_match_formation.home_formation_by_X, df_match_formation.away_formation_by_X]).value_counts()
```




    4231       10969
    442        10146
    433         7315
    451         1869
    4411        1627
               ...  
    12331          1
    13141          1
    21421          1
    312121         1
    1112221        1
    Length: 147, dtype: int64




```python
np.sum(pd.concat([df_match_formation.home_formation_by_X, df_match_formation.away_formation_by_X]).value_counts() == 1)
```




    36



- Out of 147 formations, 
    - 103 formations have appeared less than 10 times in 21,361 total matches.
    - 36 formations have appeared only once in 21,361 total matches.
- These formations do not have information from past matches to predict match results.
- So, to give the formation a sufficient pooling effect, let's make the formation by using the number of defenders, midfielders, and forward that can be extracted by Y position information.

- Y coordinates between 2 and 5 are defenders, Y coordinates between 6 and 8 are midfielders and Y coordinates 9-11 are forwards.
- Let's make colums num_defenders, num_midfielders, and num_forwards for both home and away teams.


```python
df_match_player_position_home = df_match_player_position[["match_api_id", 'home_player_Y2', 'home_player_Y3',
                                                          'home_player_Y4', 'home_player_Y5', 'home_player_Y6', 
                                                          'home_player_Y7', 'home_player_Y8', 'home_player_Y9', 
                                                          'home_player_Y10','home_player_Y11']]
```


```python
df_match_player_position_away = df_match_player_position[["match_api_id", 'away_player_Y2', 'away_player_Y3',
                                                          'away_player_Y4', 'away_player_Y5', 'away_player_Y6', 
                                                          'away_player_Y7', 'away_player_Y8', 'away_player_Y9', 
                                                          'away_player_Y10','away_player_Y11']]
```


```python
home_num_def_list = np.multiply((df_match_player_position_home.home_player_Y2 >= 2) & (df_match_player_position_home.home_player_Y2 <= 5), 1)
home_num_mid_list = np.multiply((df_match_player_position_home.home_player_Y2 >= 6) & (df_match_player_position_home.home_player_Y2 <= 8), 1)
home_num_for_list = np.multiply((df_match_player_position_home.home_player_Y2 >= 9) & (df_match_player_position_home.home_player_Y2 <= 11), 1)

for i in range(3,12):
    home_num_def_list += np.multiply((df_match_player_position_home[f"home_player_Y{i}"] >= 2) & (df_match_player_position_home[f"home_player_Y{i}"] <= 5), 1)
    home_num_mid_list += np.multiply((df_match_player_position_home[f"home_player_Y{i}"] >= 6) & (df_match_player_position_home[f"home_player_Y{i}"] <= 8), 1)
    home_num_for_list += np.multiply((df_match_player_position_home[f"home_player_Y{i}"] >= 9) & (df_match_player_position_home[f"home_player_Y{i}"] <= 11), 1)
    

```


```python
away_num_def_list = np.multiply((df_match_player_position_away.away_player_Y2 >= 2) & (df_match_player_position_away.away_player_Y2 <= 5), 1)
away_num_mid_list = np.multiply((df_match_player_position_away.away_player_Y2 >= 6) & (df_match_player_position_away.away_player_Y2 <= 8), 1)
away_num_for_list = np.multiply((df_match_player_position_away.away_player_Y2 >= 9) & (df_match_player_position_away.away_player_Y2 <= 11), 1)

for i in range(3,12):
    away_num_def_list += np.multiply((df_match_player_position_away[f"away_player_Y{i}"] >= 2) & (df_match_player_position_away[f"away_player_Y{i}"] <= 5), 1)
    away_num_mid_list += np.multiply((df_match_player_position_away[f"away_player_Y{i}"] >= 6) & (df_match_player_position_away[f"away_player_Y{i}"] <= 8), 1)
    away_num_for_list += np.multiply((df_match_player_position_away[f"away_player_Y{i}"] >= 9) & (df_match_player_position_away[f"away_player_Y{i}"] <= 11), 1)
```


```python
df_match_formation["home_num_def"] = home_num_def_list
df_match_formation["home_num_mid"] = home_num_mid_list
df_match_formation["home_num_for"] = home_num_for_list

df_match_formation["away_num_def"] = away_num_def_list
df_match_formation["away_num_mid"] = away_num_mid_list
df_match_formation["away_num_for"] = away_num_for_list

```


```python
df_match_formation["home_formation_by_Y"] = list(map("".join, zip(df_match_formation.home_num_def.astype("str"), 
                                                                  df_match_formation.home_num_mid.astype("str"),
                                                                  df_match_formation.home_num_for.astype("str"))))
```


```python
df_match_formation["away_formation_by_Y"] = list(map("".join, zip(df_match_formation.away_num_def.astype("str"), 
                                                                  df_match_formation.away_num_mid.astype("str"),
                                                                  df_match_formation.away_num_for.astype("str"))))
```


```python
df_match_formation = df_match_formation.drop(["home_num_def", "home_num_mid", "home_num_for", 
                                              "away_num_def", "away_num_mid", "away_num_for"], axis = 1)
```


```python
df_match_formation
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>match_api_id</th>
      <th>home_formation_by_X</th>
      <th>away_formation_by_X</th>
      <th>home_formation_by_Y</th>
      <th>away_formation_by_Y</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>145</th>
      <td>493017</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>153</th>
      <td>493025</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>155</th>
      <td>493027</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>162</th>
      <td>493034</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>168</th>
      <td>493040</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
      <td>442</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>25972</th>
      <td>1992089</td>
      <td>442</td>
      <td>4231</td>
      <td>442</td>
      <td>451</td>
    </tr>
    <tr>
      <th>25974</th>
      <td>1992091</td>
      <td>4231</td>
      <td>4231</td>
      <td>451</td>
      <td>451</td>
    </tr>
    <tr>
      <th>25975</th>
      <td>1992092</td>
      <td>3412</td>
      <td>433</td>
      <td>343</td>
      <td>433</td>
    </tr>
    <tr>
      <th>25976</th>
      <td>1992093</td>
      <td>4231</td>
      <td>4231</td>
      <td>451</td>
      <td>451</td>
    </tr>
    <tr>
      <th>25978</th>
      <td>1992095</td>
      <td>442</td>
      <td>4231</td>
      <td>442</td>
      <td>451</td>
    </tr>
  </tbody>
</table>
<p>21361 rows × 5 columns</p>
</div>




```python
pd.concat([df_match_formation.home_formation, df_match_formation.away_formation]).value_counts()
```




    451    14937
    442    12984
    433     8475
    352     1518
    523     1188
    343     1080
    712      770
    532      648
    622      617
    541      488
    361       17
    dtype: int64



- Save the formation data frame.


```python
df_match_formation.to_csv("../data/df_match_formation.csv", index = False)
```

## 1.2. Mode position of each player

- Player position also can be used to cluster players with other player attributes variables later.
- So let's find the mode X, Y positions of each player.


```python
df_player = pd.read_csv("../data/df_player.csv")
```


```python
player_position_X_map = {}
player_position_Y_map = {}

for id in df_player.player_api_id.unique():
    player_position_X_map[id] = []
    player_position_Y_map[id] = []

for i in df_match_player.index:
    for j in range(1,12):
        player_api_id = df_match_player[f"home_player_{j}"][i]
        
        player_position_X = df_match_player[f"home_player_X{j}"][i]
        player_position_Y = df_match_player[f"home_player_Y{j}"][i]
        
        player_position_X_map[player_api_id].append(player_position_X)
        player_position_Y_map[player_api_id].append(player_position_Y)
```


```python
df_player_position = pd.DataFrame(columns = ["player_api_id", "position_X_list", "position_Y_list"])
```


```python
df_player_position["player_api_id"] = df_player[["player_api_id"]].drop_duplicates()
```


```python
for k, v in player_position_X_map.items():
    df_player_position.loc[df_player_position.player_api_id == k, "position_X_list"] \
        = df_player_position.loc[df_player_position.player_api_id == k, "position_X_list"].apply(lambda x: v)
```


```python
for k, v in player_position_Y_map.items():
    df_player_position.loc[df_player_position.player_api_id == k, "position_Y_list"] \
        = df_player_position.loc[df_player_position.player_api_id == k, "position_Y_list"].apply(lambda x: v)
```


```python
df_player_position
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>player_api_id</th>
      <th>position_X_list</th>
      <th>position_Y_list</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>505942</td>
      <td>[6.0, 6.0, 6.0]</td>
      <td>[3.0, 3.0, 3.0]</td>
    </tr>
    <tr>
      <th>5</th>
      <td>155782</td>
      <td>[8.0, 8.0, 8.0, 8.0, 8.0, 8.0, 8.0, 8.0, 8.0, ...</td>
      <td>[3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, ...</td>
    </tr>
    <tr>
      <th>38</th>
      <td>162549</td>
      <td>[5.0, 5.0, 5.0, 5.0, 5.0, 8.0, 4.0, 8.0, 5.0, ...</td>
      <td>[11.0, 9.0, 11.0, 9.0, 11.0, 7.0, 7.0, 7.0, 10...</td>
    </tr>
    <tr>
      <th>64</th>
      <td>30572</td>
      <td>[6.0, 6.0, 7.0]</td>
      <td>[3.0, 3.0, 3.0]</td>
    </tr>
    <tr>
      <th>87</th>
      <td>23780</td>
      <td>[4.0, 4.0, 4.0, 4.0, 4.0, 4.0, 6.0, 6.0, 4.0, ...</td>
      <td>[3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, ...</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>183924</th>
      <td>26357</td>
      <td>[6.0, 6.0, 6.0, 5.0, 6.0, 6.0, 6.0, 6.0, 6.0, ...</td>
      <td>[3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, 3.0, ...</td>
    </tr>
    <tr>
      <th>183937</th>
      <td>111182</td>
      <td>[8.0]</td>
      <td>[3.0]</td>
    </tr>
    <tr>
      <th>183953</th>
      <td>36491</td>
      <td>[8.0, 8.0, 8.0, 8.0, 8.0, 8.0]</td>
      <td>[3.0, 3.0, 3.0, 3.0, 3.0, 3.0]</td>
    </tr>
    <tr>
      <th>183960</th>
      <td>35506</td>
      <td>[6.0]</td>
      <td>[3.0]</td>
    </tr>
    <tr>
      <th>183968</th>
      <td>39902</td>
      <td>[4.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, 5.0, ...</td>
      <td>[10.0, 9.0, 10.0, 8.0, 9.0, 8.0, 9.0, 9.0, 9.0...</td>
    </tr>
  </tbody>
</table>
<p>11060 rows × 3 columns</p>
</div>



- Let's check the standard deviation of each player's X and Y position values.


```python
df_player_position.explode("position_X_list")[["player_api_id", "position_X_list"]].groupby("player_api_id").std() \
    .rename(columns = {"position_X_list": "X_std_within_player"}).describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>X_std_within_player</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>9310.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>1.177388</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.790329</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.676597</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>1.154701</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.680871</td>
    </tr>
    <tr>
      <th>max</th>
      <td>5.656854</td>
    </tr>
  </tbody>
</table>
</div>




```python
my_histogram(df_player_position.explode("position_X_list")[["player_api_id", "position_X_list"]].groupby("player_api_id").std() \
                               .rename(columns = {"position_X_list": "X_std_within_player"}), "X_std_within_player")
```


    
![png](/assets/images/projects/european_soccer_prediction/2.2.eda_match_player_71_0.png)
    


- Each player's standard deviation of their past X position values are very low. That is, each player's X positions usually do not change much from game to game.


```python
df_player_position.explode("position_Y_list")[["player_api_id", "position_Y_list"]].groupby("player_api_id").std() \
    .rename(columns = {"position_Y_list": "Y_std_within_player"}).describe()
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>Y_std_within_player</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>count</th>
      <td>9310.000000</td>
    </tr>
    <tr>
      <th>mean</th>
      <td>0.650073</td>
    </tr>
    <tr>
      <th>std</th>
      <td>0.701840</td>
    </tr>
    <tr>
      <th>min</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>25%</th>
      <td>0.000000</td>
    </tr>
    <tr>
      <th>50%</th>
      <td>0.507257</td>
    </tr>
    <tr>
      <th>75%</th>
      <td>1.129319</td>
    </tr>
    <tr>
      <th>max</th>
      <td>4.949747</td>
    </tr>
  </tbody>
</table>
</div>




```python
my_histogram(df_player_position.explode("position_Y_list")[["player_api_id", "position_Y_list"]].groupby("player_api_id").std() \
                               .rename(columns = {"position_Y_list": "Y_std_within_player"}), "Y_std_within_player")
```


    
![png](/assets/images/projects/european_soccer_prediction/2.2.eda_match_player_74_0.png)
    


- Each player's standard deviation of their past Y position values are very low. That is, each player's Y positions usually do not change much from game to game.

- So, let's make each player's mode X and Y position column in the df_player table and use them for player clustering later.


```python
position_Y_mode = df_player_position.explode("position_Y_list")[["player_api_id", "position_Y_list"]].groupby("player_api_id")["position_Y_list"] \
                                    .apply(pd.Series.mode).reset_index() \
                                    .rename(columns = {"position_Y_list": "position_Y_mode"}).drop("level_1", axis = 1)
    
```


```python
position_Y_mode
```




<div>
<style scoped>
    .dataframe tbody tr th:only-of-type {
        vertical-align: middle;
    }

    .dataframe tbody tr th {
        vertical-align: top;
    }

    .dataframe thead th {
        text-align: right;
    }
</style>
<table border="1" class="dataframe">
  <thead>
    <tr style="text-align: right;">
      <th></th>
      <th>player_api_id</th>
      <th>position_Y_mode</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <th>0</th>
      <td>2625</td>
      <td>6.0</td>
    </tr>
    <tr>
      <th>1</th>
      <td>2625</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>2</th>
      <td>2752</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>3</th>
      <td>2768</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>4</th>
      <td>2770</td>
      <td>7.0</td>
    </tr>
    <tr>
      <th>...</th>
      <td>...</td>
      <td>...</td>
    </tr>
    <tr>
      <th>10693</th>
      <td>728478</td>
      <td>8.0</td>
    </tr>
    <tr>
      <th>10694</th>
      <td>730065</td>
      <td>10.0</td>
    </tr>
    <tr>
      <th>10695</th>
      <td>733787</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>10696</th>
      <td>748432</td>
      <td>3.0</td>
    </tr>
    <tr>
      <th>10697</th>
      <td>750584</td>
      <td>7.0</td>
    </tr>
  </tbody>
</table>
<p>10698 rows × 2 columns</p>
</div>




```python
position_Y_mode_temp = df_player_position.explode("position_Y_list")[["player_api_id", "position_Y_list"]].groupby("player_api_id")["position_Y_list"] \
                                         .apply(pd.Series.mode).reset_index()
position_Y_mode= position_Y_mode_temp.loc[position_Y_mode_temp.level_1 == 0, ["player_api_id", "position_Y_list"]] \
                                     .rename(columns = {"position_Y_list": "position_Y_mode"})
position_Y_mode["position_Y_mode"] = position_Y_mode.position_Y_mode.astype("int")                                      
                                         
```


```python
position_X_mode_temp = df_player_position.explode("position_X_list")[["player_api_id", "position_X_list"]].groupby("player_api_id")["position_X_list"] \
                                         .apply(pd.Series.mode).reset_index()
position_X_mode= position_X_mode_temp.loc[position_X_mode_temp.level_1 == 0, ["player_api_id", "position_X_list"]] \
                                     .rename(columns = {"position_X_list": "position_X_mode"})
position_X_mode["position_X_mode"] = position_X_mode.position_X_mode.astype("int")                                      
```


```python
df_player = df_player.merge(position_X_mode, how = "left", on = "player_api_id") \
                     .merge(position_Y_mode, how = "left", on = "player_api_id") 
```

- Also we can categorize players into 4 position based on mode Y position: {"goalkeeper", "defender", "midfielder", "forward"}
    - mode Y position = 1: goalkeeper
    - $2 \leq \text{ mode Y position } \leq 5$: defender
    - $6 \leq \text{ mode Y position } \leq 8$: midefielder
    - $9 \leq \text{ mode Y position } \leq 11$: forward



```python
goalkeeper_bool = (df_player.position_Y_mode == 1)
defender_bool = (df_player.position_Y_mode >= 2) & (df_player.position_Y_mode <= 5)
midfielder_bool = (df_player.position_Y_mode >= 6) & (df_player.position_Y_mode <= 8)
forward_bool = (df_player.position_Y_mode >= 9) & (df_player.position_Y_mode <= 11)

df_player.loc[goalkeeper_bool, "position_role"] = "goalkeeper"
df_player.loc[defender_bool, "position_role"] = "defender"
df_player.loc[midfielder_bool, "position_role"] = "midfielder"
df_player.loc[forward_bool, "position_role"] = "forward"
```

- Save the updated df_player table.



```python
df_player.to_csv("../data/df_player.csv", index = False)
```

# 2. Starting lineup


```python
starting_lineup_cols = ["match_api_id", 'home_player_1', 'home_player_2', 'home_player_3',
                        'home_player_4', 'home_player_5', 'home_player_6', 'home_player_7',
                        'home_player_8', 'home_player_9', 'home_player_10', 'home_player_11',
                        'away_player_1', 'away_player_2', 'away_player_3', 'away_player_4',
                        'away_player_5', 'away_player_6', 'away_player_7', 'away_player_8',
                        'away_player_9', 'away_player_10', 'away_player_11']
```


```python
msno.matrix(df_match_player[starting_lineup_cols])
```




    <AxesSubplot:>




    
![png](/assets/images/projects/european_soccer_prediction/2.2.eda_match_player_88_1.png)
    


- Since we alread droped all missing values, there is no missing value in the starting lineup columns.

- Starting lineup colums will be used to merge other player related tables later.

# <font color="magenta">3. Summary</font>

- Drop the matches that have the missing value in the starting lineups and the player positions.
    - 25,979 matches -> 21,351 matches
        - train matces: 22,653 -> 18,343 
        - test matches: 3,326 -> 3,018    

- Make the home and away team's starting formation variables based on starting player's X and Y positions.
    - home_formation_by_X (in df_match_formation table)
    - home_formation_by_Y (in df_match_formation table)
    - away_formation_by_X (in df_match_formation table)
    - away_formation_by_Y (in df_match_formation table)

- Make each player's mode X and Y position variables that will be used for players clustering later.
    - position_X_mode (in df_player table)
    - position_Y_mode (in df_player table)

- Make each player's role variable based on mode Y position.
    - position_role (in df_player table)

![2.2.summary](/assets/images/projects/european_soccer_prediction/2.2.eda-summary.png)


